<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>搭建一个包含 redux、router、国际化的前端项目框架 | 梁新维</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">搭建一个包含 redux、router、国际化的前端项目框架</h1><a id="logo" href="/.">梁新维</a><p class="description">sometimes code， sometimes design</p></div><div id="nav-menu"><a href="/"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">搭建一个包含 redux、router、国际化的前端项目框架</h1><div class="post-meta">Jun 8, 2017<span> | </span><span class="category"><a href="/categories/前端/">前端</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>搭建一个交互比较多的 <strong>react 前端项目框架</strong>，数据可预测，可路由跳转，可国际化，数据操作可控制</p>
<h2 id="使用的主要类库"><a href="#使用的主要类库" class="headerlink" title="使用的主要类库"></a>使用的主要类库</h2><ul>
<li>i18next 国际化</li>
<li>react-i18next</li>
<li>i18next-browser-languagedetector</li>
<li>immutability-helper</li>
<li>immutable 处理数据</li>
<li>react</li>
<li>react-dom</li>
<li>react-redux 管理数据</li>
<li>react-router 路由</li>
<li>react-router-redux 路由接入 store</li>
<li>redux<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2></li>
</ul>
<ul>
<li>因为 router 是异步过程，所以注入到 store 中，通过 action 跳转路由</li>
<li>在 react-redux 原生 action、reducer 之上封装了一层，便于分发、匹配 action、reducer</li>
<li>执行顺序： action -&gt; 前置拦截器（return true）-&gt; reducer（修改 store）-&gt; componentWillReceiveProps -&gt; shouldComponentUpdate（return true）-&gt; render -&gt; 后置拦截器</li>
</ul>
<p><strong>项目地址</strong>：<a href="https://github.com/liangxinwei/redux-ele" target="_blank" rel="noopener">https://github.com/liangxinwei/redux-ele</a></p>
<h2 id="项目布局"><a href="#项目布局" class="headerlink" title="项目布局"></a>项目布局</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">├── cfg                                 webpack 配置文件</span><br><span class="line">│   ├── base.js                        webpack 配置</span><br><span class="line">│   ├── default.js                     loader，plugin</span><br><span class="line">│   ├── dev.js                         dev 环境 </span><br><span class="line">│   └── dist.js                        dist 环境</span><br><span class="line">├── src                                 源码目录</span><br><span class="line">│   ├── app</span><br><span class="line">│   │   ├── component                  具体业务组件，配合 routes 目录使用</span><br><span class="line">│   │   ├── config                     store 配置</span><br><span class="line">│   │   │   ├── AppActionRouter.js    分发相应 type 的 action</span><br><span class="line">│   │   │   ├── AppReducerCreator.js  匹配相应 type 的 action 的 reducer</span><br><span class="line">│   │   │   ├── ConfigureStore.js       生成 store</span><br><span class="line">│   │   │   └── index.js                统一导出</span><br><span class="line">│   │   ├── i18n                        	国际化配置</span><br><span class="line">│   │   │   ├── locales                	中英文配置文件</span><br><span class="line">│   │   │   │   ├── en                 英文配置</span><br><span class="line">│   │   │   │   └── zh                 中文配置</span><br><span class="line">│   │   │   ├── i18n.js                 i18next 配置</span><br><span class="line">│   │   │   └── index.js                统一导出</span><br><span class="line">│   │   ├── middleware                   中间件</span><br><span class="line">│   │   │   ├── AppMiddleWare.js        前置、后置拦截器业务代码</span><br><span class="line">│   │   │   ├── ComponentMiddleWare.js  操作拦截器中间件</span><br><span class="line">│   │   │   ├── index.js                中间件统一导出</span><br><span class="line">│   │   │   └── LoggerMiddleWare.js     日志中间件</span><br><span class="line">│   │   ├── routes                       路由配置</span><br><span class="line">│   │   │   └── index.jsx</span><br><span class="line">│   │   └── App.jsx                      app 入口</span><br><span class="line">│   ├── index.ejs                         ejs 模板文件</span><br><span class="line">│   └── index.jsx                         挂载 react dom</span><br><span class="line">├── test</span><br><span class="line">├── .babelrc                            babel 配置文件</span><br><span class="line">├── .editorconfig                       跨平台编辑器配置文件</span><br><span class="line">├── .eslintignore                       eslintignore 配置文件</span><br><span class="line">├── .eslintrc                           eslint 配置文件</span><br><span class="line">├── .gitignore</span><br><span class="line">├── package.json   </span><br><span class="line">├── postcss.config.js                   postcss 配置文件 </span><br><span class="line">├── server.js                           本地服务（webpack-dev-server）</span><br><span class="line">├── webpack.config.js                   webpack 配置文件入口</span><br><span class="line">└── README.md</span><br></pre></td></tr></table></figure>

<h2 id="App-jsx-项目入口"><a href="#App-jsx-项目入口" class="headerlink" title="App.jsx 项目入口"></a>App.jsx 项目入口</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123;Component&#125; from &apos;react&apos;;</span><br><span class="line">import &#123;Provider&#125; from &apos;react-redux&apos;;</span><br><span class="line">import &#123;I18nextProvider&#125; from &apos;react-i18next&apos;;</span><br><span class="line">import &#123;syncHistoryWithStore&#125; from &apos;react-router-redux&apos;;</span><br><span class="line">import &#123;hashHistory&#125; from &apos;react-router&apos;;</span><br><span class="line"></span><br><span class="line">import &#123;reducers&#125; from &apos;./components&apos;; //合并之后的 reducer</span><br><span class="line">import &#123;default as Store&#125; from &apos;./config/ConfigureStore&apos;;</span><br><span class="line">import appMiddleWares from &apos;./middleware/AppMiddleWare&apos;;</span><br><span class="line"></span><br><span class="line">import &#123;i18n, locales&#125; from &apos;./i18n&apos;; //见下面 i18n 配置</span><br><span class="line">import routes from &apos;./routes&apos;;</span><br><span class="line">import &apos;./style/index.scss&apos;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * App View</span><br><span class="line"> */</span><br><span class="line">class App extends Component &#123;</span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">        // 添加i18n语言包</span><br><span class="line">        for (let ns in locales[&apos;zh&apos;]) &#123;</span><br><span class="line">            if (locales[&apos;zh&apos;].hasOwnProperty(ns)) &#123;</span><br><span class="line">                i18n.addResourceBundle(&apos;zh&apos;, ns, locales[&apos;zh&apos;][ns]);</span><br><span class="line">                i18n.addResourceBundle(&apos;en&apos;, ns, locales[&apos;en&apos;][ns]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        let storeOptions = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        const defaultStates = &#123;&#125;;</span><br><span class="line">        const allReducers = Object.assign(&#123;&#125;, reducers);  //此处可以并入其它模块中的 reducer</span><br><span class="line">        const preMiddleWares = Object.assign(&#123;&#125;, appMiddleWares.preMiddleWares);  //此处可以并入其它模块中的 preMiddleWares</span><br><span class="line">        const postMiddleWares = Object.assign(&#123;&#125;, appMiddleWares.postMiddleWares);  //此处可以并入其它模块中的 postMiddleWares</span><br><span class="line"></span><br><span class="line">        storeOptions.initialStates = defaultStates;</span><br><span class="line">        storeOptions.reducers = allReducers;</span><br><span class="line">        storeOptions.preMiddleWares = preMiddleWares;</span><br><span class="line">        storeOptions.postMiddleWares = postMiddleWares;</span><br><span class="line"></span><br><span class="line">        const store = Store.configureStore(storeOptions);</span><br><span class="line">        const history = syncHistoryWithStore(hashHistory, store);</span><br><span class="line"></span><br><span class="line">        return (</span><br><span class="line">            &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">                &lt;I18nextProvider i18n=&#123;i18n&#125;&gt;</span><br><span class="line">                    &#123;routes(history)&#125;</span><br><span class="line">                &lt;/I18nextProvider&gt;</span><br><span class="line">            &lt;/Provider&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>

<h2 id="routes-路由配置"><a href="#routes-路由配置" class="headerlink" title="routes 路由配置"></a>routes 路由配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123;Router, Route&#125; from &apos;react-router&apos;;</span><br><span class="line"></span><br><span class="line">import &#123;</span><br><span class="line">    HomeView,</span><br><span class="line">    BusinessDetail</span><br><span class="line">&#125; from &apos;../components&apos;;</span><br><span class="line"></span><br><span class="line">const routes = (history) =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;Router history=&#123;history&#125;&gt;</span><br><span class="line">            &lt;Route path=&quot;/&quot; component=&#123;HomeView&#125;/&gt;</span><br><span class="line">            &lt;Route path=&quot;/home&quot; component=&#123;HomeView&#125;/&gt;</span><br><span class="line">            &lt;Route path=&quot;/business/:id&quot; component=&#123;BusinessDetail&#125;/&gt;</span><br><span class="line">        &lt;/Router&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default routes;</span><br></pre></td></tr></table></figure>

<h2 id="ConfigureStore-js-构建-Store"><a href="#ConfigureStore-js-构建-Store" class="headerlink" title="ConfigureStore.js 构建 Store"></a>ConfigureStore.js 构建 Store</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import &#123;applyMiddleware, compose, createStore, combineReducers&#125; from &apos;redux&apos;;</span><br><span class="line">import thunk from &apos;redux-thunk&apos;;</span><br><span class="line">import &#123;hashHistory&#125; from &apos;react-router&apos;;</span><br><span class="line">import &#123;routerReducer, routerMiddleware&#125; from &apos;react-router-redux&apos;;</span><br><span class="line"></span><br><span class="line">import &#123;componentMiddleWare, logger&#125; from &apos;../middleware&apos;;</span><br><span class="line">import appReducerCreator from &apos;./AppReducerCreator&apos;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * store 构建器</span><br><span class="line"> */</span><br><span class="line">export function configureStore(config) &#123;</span><br><span class="line">    // 合并之后的 preMiddleWares, postMiddleWares, reducers</span><br><span class="line">    let &#123;initialStates, preMiddleWares, postMiddleWares, reducers&#125; = config;</span><br><span class="line">    let allReducer = Object.assign(&#123;&#125;, reducers);</span><br><span class="line">    let appReducer = appReducerCreator(initialStates, allReducer);</span><br><span class="line">    const finalReducer = combineReducers(&#123;appReducer, routing: routerReducer&#125;);</span><br><span class="line">    const allMiddleWares = [</span><br><span class="line">        thunk,  // 异步 action</span><br><span class="line">        componentMiddleWare(preMiddleWares, postMiddleWares),    // 具体业务拦截器</span><br><span class="line">        routerMiddleware(hashHistory),   // router 注入到 store 中</span><br><span class="line">        logger</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    let enhancer = compose(</span><br><span class="line">        applyMiddleware(...allMiddleWares)</span><br><span class="line">    );</span><br><span class="line">    return createStore(finalReducer, &#123;&#125;, enhancer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Store = &#123;</span><br><span class="line">    configureStore</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default Store;</span><br></pre></td></tr></table></figure>

<h2 id="AppReducerCreator-js"><a href="#AppReducerCreator-js" class="headerlink" title="AppReducerCreator.js"></a>AppReducerCreator.js</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 全局 Reducer 产生器</span><br><span class="line"> */</span><br><span class="line">function appReducerCreator(wrapInitialState, allReducerMap) &#123;</span><br><span class="line">    function appReducer(state = wrapInitialState, action) &#123;</span><br><span class="line">        if (action &amp;&amp; action.type &amp;&amp; allReducerMap[action.type]) &#123;</span><br><span class="line">            return allReducerMap[action.type](state, action);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return state;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return appReducer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default appReducerCreator;</span><br></pre></td></tr></table></figure>

<h2 id="ComponentMiddleWare-js-action-拦截器"><a href="#ComponentMiddleWare-js-action-拦截器" class="headerlink" title="ComponentMiddleWare.js action 拦截器"></a>ComponentMiddleWare.js action 拦截器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 操作拦截器中间件</span><br><span class="line"> */</span><br><span class="line">export function componentMiddleWare(preMiddleWares, postMiddleWares) &#123;</span><br><span class="line">    return function (&#123;getState&#125;) &#123;</span><br><span class="line">        return next =&gt; (action) =&gt; &#123;</span><br><span class="line">            // 前置拦截校验函数</span><br><span class="line">            let preInterceptFunc = preMiddleWares ? preMiddleWares[action.type] : null;</span><br><span class="line">            // 进行拦截校验操作</span><br><span class="line">            if (preInterceptFunc &amp;&amp; !preInterceptFunc.call(this, action, getState())) &#123;</span><br><span class="line">                console.error(&apos;Invalid action for preMiddleWares intercept!!&apos;);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // 调用 middleware 链中下一个 middleware 的 dispatch。</span><br><span class="line">            const returnValue = next(action);</span><br><span class="line"></span><br><span class="line">            // 后置拦截函数</span><br><span class="line">            let postInterceptFunc = postMiddleWares ? postMiddleWares[action.type] : null;</span><br><span class="line">            // 进行拦截校验操作</span><br><span class="line">            postInterceptFunc &amp;&amp; postInterceptFunc.call(this, action, getState());</span><br><span class="line">            </span><br><span class="line">            return returnValue;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="LoggerMiddleWare-js"><a href="#LoggerMiddleWare-js" class="headerlink" title="LoggerMiddleWare.js"></a>LoggerMiddleWare.js</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 日志 MiddleWare</span><br><span class="line"> */</span><br><span class="line">export function logger(&#123;getState&#125;) &#123;</span><br><span class="line">    return next =&gt; (action) =&gt; &#123;</span><br><span class="line">        console.info(&apos;will dispatch&apos;, action);</span><br><span class="line">        // 调用 middleware 链中下一个 middleware 的 dispatch。</span><br><span class="line">        const returnValue = next(action);</span><br><span class="line">        console.info(&apos;after dispatch&apos;, getState());</span><br><span class="line">        return returnValue;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AppMiddleWare-js-具体业务中间件，构建-store-时注入"><a href="#AppMiddleWare-js-具体业务中间件，构建-store-时注入" class="headerlink" title="AppMiddleWare.js 具体业务中间件，构建 store 时注入"></a>AppMiddleWare.js 具体业务中间件，构建 store 时注入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 前置拦截器</span><br><span class="line"> */</span><br><span class="line">let preMiddleWares = &#123;</span><br><span class="line">    TEST: (action, state) =&gt; &#123;</span><br><span class="line">        return true;// false 则本次 action 无效，数据不会被修改</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 后置拦截器</span><br><span class="line"> */</span><br><span class="line">let postMiddleWares = &#123;</span><br><span class="line">    TEST: (action, state) =&gt; &#123;</span><br><span class="line">        ··· // 此处修改之后不会立即在 ui 上体现出来，因为它在 render 之后执行。且因为参数 state 为引用，所以是直接修改，可做一些提示性的操作</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let appMiddleWares = &#123;</span><br><span class="line">    preMiddleWares,</span><br><span class="line">    postMiddleWares</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default appMiddleWares;</span><br></pre></td></tr></table></figure>

<h2 id="connectToStore-js-组件接入-store-decorator"><a href="#connectToStore-js-组件接入-store-decorator" class="headerlink" title="connectToStore.js 组件接入 store decorator"></a>connectToStore.js 组件接入 store decorator</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import &#123;bindActionCreators&#125; from &apos;redux&apos;;</span><br><span class="line">import &#123;connect&#125; from &apos;react-redux&apos;;</span><br><span class="line">import appConfig from &apos;../config&apos;;</span><br><span class="line">// appConfig.router 即下面的 AppActionRouter.js</span><br><span class="line">const AppActionRouter = appConfig.router;</span><br><span class="line"></span><br><span class="line">function mapStateToProps(state) &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        store: state.appReducer || &#123;&#125;,</span><br><span class="line">        routerStore: (state.routing &amp;&amp; state.routing.locationBeforeTransitions) || &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mapDispatchToProps(dispatch) &#123;</span><br><span class="line">    return bindActionCreators(AppActionRouter, dispatch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default function connectToStore(component) &#123;</span><br><span class="line">    return connect(mapStateToProps, mapDispatchToProps)(component);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AppActionRouter-js-分发-action"><a href="#AppActionRouter-js-分发-action" class="headerlink" title="AppActionRouter.js 分发 action"></a>AppActionRouter.js 分发 action</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import &#123;actions&#125; from &apos;../components&apos;;</span><br><span class="line">// action 为合并之后的所有的 action</span><br><span class="line">/**</span><br><span class="line"> * app action Router</span><br><span class="line"> */</span><br><span class="line">function onClickWithoutCheck(action) &#123;</span><br><span class="line">    return action;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 如果外部注入 action，那么直接使用 action 的操作即可。</span><br><span class="line"> * 如果外部没有注入 action， 使用 dispatch 操作。</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">export function onClickAction(action, props) &#123;</span><br><span class="line">    return function (dispatch, getState) &#123;</span><br><span class="line">        if (action.type &amp;&amp; actions.hasOwnProperty(action.type)) &#123;</span><br><span class="line">            actions[action.type].call(this, action, dispatch, props);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            dispatch(onClickWithoutCheck(action));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="acion-示例"><a href="#acion-示例" class="headerlink" title="acion 示例"></a>acion 示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let homeActions = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">homeActions[&apos;TEST&apos;] = function (action, dispatch, state) &#123;</span><br><span class="line">    dispatch(action);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default homeActions;</span><br></pre></td></tr></table></figure>

<h2 id="reducer-示例"><a href="#reducer-示例" class="headerlink" title="reducer 示例"></a>reducer 示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import Immutable from &apos;immutable&apos;;</span><br><span class="line"></span><br><span class="line">let homeReducers = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">homeReducers[&apos;TEST&apos;] = function (state, action) &#123;</span><br><span class="line">    let foo = Immutable.fromJS(state);</span><br><span class="line">    let newArr = foo.mergeDeep(Immutable.fromJS(action.content));</span><br><span class="line">    return newArr.toJS();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default homeReducers;</span><br></pre></td></tr></table></figure>

<h2 id="i18n-配置"><a href="#i18n-配置" class="headerlink" title="i18n 配置"></a>i18n 配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import i18next from &apos;i18next&apos;;</span><br><span class="line">import LanguageDetector from &apos;i18next-browser-languagedetector&apos;;</span><br><span class="line"></span><br><span class="line">const i18n = i18next</span><br><span class="line">    .use(LanguageDetector)</span><br><span class="line">    .init(&#123;</span><br><span class="line">        fallbackLng: &apos;zh&apos;,</span><br><span class="line"></span><br><span class="line">        // have a common namespace used around the full app</span><br><span class="line">        ns: [&apos;common&apos;],</span><br><span class="line">        defaultNS: &apos;common&apos;,</span><br><span class="line"></span><br><span class="line">        debug: false,</span><br><span class="line"></span><br><span class="line">        interpolation: &#123;</span><br><span class="line">            escapeValue: false // not needed for react!!</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, (err) =&gt; &#123;</span><br><span class="line">        if (err) &#123;</span><br><span class="line">            console.error(&apos;i18next&apos;, err);</span><br><span class="line">        &#125;</span><br><span class="line">        // console.log(&apos;i18next initialized and ready to go!&apos;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">export default i18n;</span><br></pre></td></tr></table></figure>

<h3 id="i18n-英文配置"><a href="#i18n-英文配置" class="headerlink" title="i18n 英文配置"></a>i18n 英文配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const home = &#123;</span><br><span class="line">    title: &apos;Home Page&apos;</span><br><span class="line">&#125;;</span><br><span class="line">export default &#123;home&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="i18n-中文配置"><a href="#i18n-中文配置" class="headerlink" title="i18n 中文配置"></a>i18n 中文配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const home = &#123;</span><br><span class="line">    title: &apos;首页&apos;</span><br><span class="line">&#125;;</span><br><span class="line">export default &#123;home&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="i18n-中英文统一导出"><a href="#i18n-中英文统一导出" class="headerlink" title="i18n 中英文统一导出"></a>i18n 中英文统一导出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import zh from &apos;./zh&apos;;</span><br><span class="line">import en from &apos;./en&apos;;</span><br><span class="line"></span><br><span class="line">const locales = &#123;</span><br><span class="line">    zh: zh,</span><br><span class="line">    en: en</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default locales;</span><br></pre></td></tr></table></figure>

<h2 id="组件实例"><a href="#组件实例" class="headerlink" title="组件实例"></a>组件实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123;Component&#125; from &apos;react&apos;;</span><br><span class="line">import &#123;translate&#125; from &apos;react-i18next&apos;;</span><br><span class="line">import i18n from &apos;../i18n&apos;;</span><br><span class="line"></span><br><span class="line">@translate([&apos;home&apos;], &#123;wait: true&#125;)  // 使用多语言</span><br><span class="line">@connectToStore                     // 组件介入 store</span><br><span class="line">class Test extends Component &#123;</span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 路由跳转</span><br><span class="line">    transformRouter = () =&gt; &#123;</span><br><span class="line">        const &#123;onClickAction&#125; = this.props;</span><br><span class="line">        // 见下面路由 acion</span><br><span class="line">        let gotoAction = &#123;</span><br><span class="line">            type: &apos;GOTO&apos;,</span><br><span class="line">            content: &apos;/home&apos;</span><br><span class="line">        &#125;;</span><br><span class="line">        onClickAction(gotoAction, this.props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 发送 action</span><br><span class="line">    changeStore = () =&gt; &#123;</span><br><span class="line">        const &#123;onClickAction, store&#125; = this.props;</span><br><span class="line">        let action = &#123;</span><br><span class="line">            type: &apos;TEST&apos;,</span><br><span class="line">            content: &#123;data: &apos;test&apos;&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        onClickAction(action, this.props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 切换语言</span><br><span class="line">    setLanguage = () =&gt; &#123;</span><br><span class="line">        i18n.changeLanguage(&apos;zh&apos;); // or en</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        const &#123;t, store&#125; = this.props;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&apos;app-home&apos;&gt;</span><br><span class="line">                &lt;div className=&apos;app-header&apos;&gt;</span><br><span class="line">                    &lt;span&gt;&#123;t(&apos;title&apos;)&#125;&lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    content</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;Footer/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Test;</span><br></pre></td></tr></table></figure>

<h2 id="路由-acion，不需要-路由-recuder"><a href="#路由-acion，不需要-路由-recuder" class="headerlink" title="路由 acion，不需要 路由 recuder"></a>路由 acion，不需要 路由 recuder</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123;push&#125; from &apos;react-router-redux&apos;;</span><br><span class="line"></span><br><span class="line">let routerActions = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">routerActions[&apos;GOTO&apos;] = function (action, dispatch, state) &#123;</span><br><span class="line">    dispatch(push(action[&apos;content&apos;]));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default routerActions;</span><br></pre></td></tr></table></figure>

</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2017/07/28/fatal-Could-not-read-from-remote-repository-的解决办法/">fatal: Could not read from remote repository.的解决办法</a><a class="next" href="/2017/05/10/一些容易被忽略的-javascript-知识点/">一些容易被忽略的 javascript 知识点</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/后端/">后端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/小程序/">小程序</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/">读书笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/01/01/2020Flag/">2020Flag</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/31/2019年终总结/">2019年终总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/12/B端产品经理长成读书笔记/">B端产品经理长成读书笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/19/九败一胜读书笔记/">九败一胜读书笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/11/roadhog-1-3-X-打包慢的解决办法/">roadhog 1.3.X 打包慢的解决办法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/30/webpack各配置项全解析/">webpack各配置项全解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/小程序和h5页面之间的互相跳转/">小程序和h5页面之间的互相跳转</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/17/微信订阅号开发之获取网页授权/">微信订阅号开发之获取网页授权</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/15/浏览器-iframe-全屏、退出全屏/">浏览器/iframe 全屏、退出全屏</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/23/javaweb常见HTTP状态码/">javaweb常见HTTP状态码</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/liangxinwei" title="GitHub" target="_blank">GitHub</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">梁新维.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zindex="-2" count="50" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>