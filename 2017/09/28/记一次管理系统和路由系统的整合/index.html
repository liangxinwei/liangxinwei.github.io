<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>记一次管理系统和路由系统的整合 | 梁新维</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">记一次管理系统和路由系统的整合</h1><a id="logo" href="/.">梁新维</a><p class="description">sometimes code， sometimes design</p></div><div id="nav-menu"><a href="/"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">记一次管理系统和路由系统的整合</h1><div class="post-meta">Sep 28, 2017<span> | </span><span class="category"><a href="/categories/前端/">前端</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h2 id="需求：整合管理系统和路由系统"><a href="#需求：整合管理系统和路由系统" class="headerlink" title="需求：整合管理系统和路由系统"></a>需求：整合管理系统和路由系统</h2><h2 id="UI："><a href="#UI：" class="headerlink" title="UI："></a>UI：</h2><p>同 <a href="https://preview.pro.ant.design/" target="_blank" rel="noopener">Ant Design Pro</a> </p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>由于左侧管理菜单内容在运行时才能确定，而且点击菜单要和右侧内容区联动，地址栏也要有相应的改变，而目前已有的路由系统都是要运行之前要确定具体的路由组建，因此采用 h5 的 history 和 传统的 document.location 结合的方式实现路由系统；整个项目的数据管理则因为考虑到左侧菜单对应的组件可能会使用包括 redux/mbox/dva/kao 之类的框架，如果也使用框架的话，可能会引起冲突，故通过 react 的 context 来实现。</p>
<h2 id="路由系统-router-js"><a href="#路由系统-router-js" class="headerlink" title="路由系统 router.js"></a>路由系统 router.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> instance = <span class="literal">undefined</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (!instance) &#123;</span><br><span class="line">            <span class="keyword">this</span>.history = <span class="built_in">window</span>.history;</span><br><span class="line">            <span class="keyword">this</span>.location = <span class="built_in">window</span>.location;</span><br><span class="line">            instance = <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    goBack = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.history.back();</span><br><span class="line">        cb &amp;&amp; cb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    goForward = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.history.forward();</span><br><span class="line">        cb &amp;&amp; cb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    go = <span class="function">(<span class="params">num, cb</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.history.go(num);</span><br><span class="line">        cb &amp;&amp; cb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pushState = <span class="function">(<span class="params">url, state, cb</span>) =&gt;</span> &#123;</span><br><span class="line">        url = url || <span class="string">''</span>;</span><br><span class="line">        <span class="comment">// 加 #，以 hash 的方式改变 url；如果不加，直接以 '/abc' 更改，刷新会报错，请求不到资源（js,css,···）</span></span><br><span class="line">        url = url[<span class="number">0</span>] === <span class="string">'/'</span> ? <span class="string">`#<span class="subst">$&#123;url&#125;</span>`</span> : <span class="string">`/#<span class="subst">$&#123;url&#125;</span>`</span>;</span><br><span class="line">        <span class="keyword">this</span>.history.pushState(state || <span class="literal">null</span>, <span class="string">''</span>, url);</span><br><span class="line">        cb &amp;&amp; cb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    replaceState = <span class="function">(<span class="params">url, state, cb</span>) =&gt;</span> &#123;</span><br><span class="line">        url = url || <span class="string">'/'</span>;</span><br><span class="line">        url = url[<span class="number">0</span>] === <span class="string">'/'</span> ? <span class="string">`#<span class="subst">$&#123;url&#125;</span>`</span> : <span class="string">`/#<span class="subst">$&#123;url&#125;</span>`</span>;</span><br><span class="line">        <span class="keyword">this</span>.history.replaceState(state || <span class="literal">null</span>, <span class="string">''</span>, url);</span><br><span class="line">        cb &amp;&amp; cb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    currentState = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.history.state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    currentUrl = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> url = <span class="keyword">this</span>.location.hash.replace(<span class="string">'#'</span>, <span class="string">''</span>);</span><br><span class="line">        <span class="keyword">if</span> (url[<span class="number">0</span>] === <span class="string">'/'</span>) &#123;</span><br><span class="line">            url = url.replace(<span class="string">'/'</span>, <span class="string">''</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rootUrl = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.location.host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    originUrl = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.location.origin;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fullUrl = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.location.href;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    historyLength = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.history.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拦截器 拦截读写权限</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> handler = &#123;</span><br><span class="line">    <span class="keyword">set</span>(target, key, value) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Setting the <span class="subst">$&#123;key&#125;</span> prototype is forbidden`</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteProperty(target, key) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Deleting the <span class="subst">$&#123;key&#125;</span> prototype is forbidden`</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    defineProperty (target, key, descriptor) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Defining the <span class="subst">$&#123;key&#125;</span> prototype is forbidden`</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    setPrototypeOf (target, proto) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Changing the prototype is forbidden'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routerInstance = <span class="keyword">new</span> <span class="built_in">Proxy</span>(<span class="keyword">new</span> Router(), handler);</span><br></pre></td></tr></table></figure>

<h2 id="路由装饰函数-withRouter-js"><a href="#路由装饰函数-withRouter-js" class="headerlink" title="路由装饰函数 withRouter.js"></a>路由装饰函数 withRouter.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> withRouter = <span class="function">(<span class="params">config = &#123;&#125;</span>) =&gt;</span> <span class="function">(<span class="params">WrapComponent</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">        <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">            <span class="keyword">super</span>(props);</span><br><span class="line">            <span class="keyword">this</span>.state = &#123;</span><br><span class="line">                data: &#123;&#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        componentDidMount() &#123;</span><br><span class="line">            config.listenPopState === <span class="literal">true</span> &amp;&amp; <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, <span class="keyword">this</span>.handlePopState);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        handlePopState = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;<span class="attr">data</span>: data&#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        componentWillUnmount() &#123;</span><br><span class="line">            config.listenPopState === <span class="literal">true</span> &amp;&amp; <span class="built_in">window</span>.removeEventListener(<span class="string">'popstate'</span>, <span class="keyword">this</span>.handlePopState);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        render() &#123;</span><br><span class="line">            <span class="keyword">const</span> router = &#123;</span><br><span class="line">                go: routerInstance.go,</span><br><span class="line">                goBack: routerInstance.goBack,</span><br><span class="line">                fullUrl: routerInstance.fullUrl,</span><br><span class="line">                rootUrl: routerInstance.rootUrl,</span><br><span class="line">                originUrl: routerInstance.originUrl,</span><br><span class="line">                goForward: routerInstance.goForward,</span><br><span class="line">                pushState: routerInstance.pushState,</span><br><span class="line">                currentUrl: routerInstance.currentUrl,</span><br><span class="line">                replaceState: routerInstance.replaceState,</span><br><span class="line">                currentState: routerInstance.currentState,</span><br><span class="line">                historyLength: routerInstance.historyLength</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> React.createElement(WrapComponent, &#123;</span><br><span class="line">                routerData: <span class="keyword">this</span>.state.data,</span><br><span class="line">                router: <span class="keyword">new</span> <span class="built_in">Proxy</span>(router, handler),<span class="comment">// handler 上面定义的拦截器</span></span><br><span class="line">                ...this.props</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="入口组建-App-js"><a href="#入口组建-App-js" class="headerlink" title="入口组建 App.js"></a>入口组建 App.js</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Layout&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> GYSider <span class="keyword">from</span> <span class="string">'./GYSider'</span>;</span><br><span class="line"><span class="keyword">import</span> GYHeader <span class="keyword">from</span> <span class="string">'./GYHeader'</span>;</span><br><span class="line"><span class="keyword">import</span> GYContent <span class="keyword">from</span> <span class="string">'./GYContent'</span>;</span><br><span class="line"><span class="keyword">import</span> Test_1 <span class="keyword">from</span> <span class="string">'../app/Test_1'</span>;</span><br><span class="line"><span class="keyword">import</span> Test_2 <span class="keyword">from</span> <span class="string">'../app/Test_2'</span>;</span><br><span class="line"><span class="keyword">import</span> Test_3 <span class="keyword">from</span> <span class="string">'../app/Test_3'</span>;</span><br><span class="line"><span class="keyword">import</span> Test_1_1_1 <span class="keyword">from</span> <span class="string">'../app/Test_1_1_1'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">'../util/router'</span>;</span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'../util/Util'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;Header, Sider, Content&#125; = Layout;</span><br><span class="line"></span><br><span class="line">@withRouter()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">const</span> propsState = props.initialState || &#123;&#125;;</span><br><span class="line">        <span class="keyword">const</span> initialState = &#123;</span><br><span class="line">            menuList: [</span><br><span class="line">                &#123;</span><br><span class="line">                    path: <span class="string">'test_1'</span>,</span><br><span class="line">                    icon: <span class="string">'user'</span>,</span><br><span class="line">                    text: <span class="string">'test_1'</span>,</span><br><span class="line">                    component: Test_1,</span><br><span class="line">                    children: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            path: <span class="string">'test_1/test_1_1'</span>,</span><br><span class="line">                            text: <span class="string">'test_1_1'</span>,</span><br><span class="line">                            children: [</span><br><span class="line">                                &#123;</span><br><span class="line">                                    path: <span class="string">'test_1/test_1_1/test_1_1_1'</span>,</span><br><span class="line">                                    component: Test_1_1_1,</span><br><span class="line">                                    text: <span class="string">'test_1_1_1'</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    path: <span class="string">'test_2'</span>,</span><br><span class="line">                    icon: <span class="string">'setting'</span>,</span><br><span class="line">                    text: <span class="string">'test_2'</span>,</span><br><span class="line">                    component: Test_2</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    path: <span class="string">'test_3'</span>,</span><br><span class="line">                    icon: <span class="string">'logout'</span>,</span><br><span class="line">                    text: <span class="string">'test_3'</span>,</span><br><span class="line">                    component: Test_3</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            store: &#123;</span><br><span class="line">                menuList: initialState.menuList.concat(propsState.menuList || [])</span><br><span class="line">            &#125;,</span><br><span class="line">            collapsed: <span class="literal">false</span>,</span><br><span class="line">            currentPath: <span class="string">''</span>,</span><br><span class="line">            currentComponent: GYContent</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">this</span>.getAllComponent(<span class="keyword">this</span>.state.store.menuList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存所有的路由对应的组件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    getAllComponent = <span class="function">(<span class="params">menuList = []</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.allComponent = <span class="keyword">this</span>.allComponent || <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">        menuList.forEach(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (val.path &amp;&amp; Util.isReactComponent(val.component)) &#123;</span><br><span class="line">                <span class="keyword">this</span>.allComponent.set(val.path, val.component);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (Util.isArray(val.children)) &#123;</span><br><span class="line">                <span class="keyword">this</span>.getAllComponent(val.children);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">        store: PropTypes.object,</span><br><span class="line">        onClickAction: PropTypes.func</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> childContextTypes = &#123;</span><br><span class="line">        store: PropTypes.object.isRequired,</span><br><span class="line">        onClickAction: PropTypes.func.isRequired</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 子组件获取 store</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    getChildContext() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            store: <span class="keyword">this</span>.state.store,</span><br><span class="line">            onClickAction: <span class="keyword">this</span>.handleClickAction</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新 store 时需要返回合并之后的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    handleClickAction = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(<span class="built_in">Object</span>.assign(<span class="keyword">this</span>.state, data));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">        <span class="comment">// 刷新浏览器，跳转到相应页面</span></span><br><span class="line">        <span class="keyword">const</span> currentPath = <span class="keyword">this</span>.state.currentPath;</span><br><span class="line">        <span class="keyword">const</span> documentHref = <span class="keyword">this</span>.props.router.currentUrl();</span><br><span class="line">        <span class="keyword">if</span> (currentPath !== documentHref &amp;&amp; <span class="keyword">this</span>.allComponent.has(documentHref)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                currentComponent: <span class="keyword">this</span>.allComponent.get(documentHref)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onToggle = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            collapsed: !<span class="keyword">this</span>.state.collapsed</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onCollapse = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'onCollapse'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> Component = <span class="keyword">this</span>.state.currentComponent;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Layout className=<span class="string">'gy-app-view'</span>&gt;</span><br><span class="line">                &lt;Sider</span><br><span class="line">                    collapsible</span><br><span class="line">                    breakpoint=<span class="string">"md"</span></span><br><span class="line">                    width=&#123;<span class="number">256</span>&#125;</span><br><span class="line">                    collapsed=&#123;<span class="keyword">this</span>.state.collapsed&#125;</span><br><span class="line">                    trigger=&#123;<span class="literal">null</span>&#125;</span><br><span class="line">                    onCollapse=&#123;<span class="keyword">this</span>.onCollapse&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                    &lt;GYSider/&gt;</span><br><span class="line">                &lt;<span class="regexp">/Sider&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Layout&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;Header className='header'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;GYHeader collapsed=&#123;this.state.collapsed&#125; onToggle=&#123;this.onToggle&#125;/</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Header&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;Content className='gy-content'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Component/</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Content&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>Layout&gt;</span><br><span class="line">            &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>

<h2 id="侧边栏组件"><a href="#侧边栏组件" class="headerlink" title="侧边栏组件"></a>侧边栏组件</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Menu, Icon&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">const</span> SubMenu = Menu.SubMenu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'../util/Util'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">'../util/router'</span>;</span><br><span class="line"><span class="keyword">import</span> connectStore <span class="keyword">from</span> <span class="string">'../util/connectStore'</span>;</span><br><span class="line"></span><br><span class="line">@withRouter()   <span class="comment">// 接入路由</span></span><br><span class="line">@connectStore   <span class="comment">// 接入 store</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GYSider</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillReceiveProps(nextProps, nextContext) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'点击 subMenu 更新 store'</span>, nextContext.store);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onMenuClick = <span class="function">(<span class="params">&#123;item, key, keyPath&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">const</span> path = item.props.path;</span><br><span class="line">        <span class="keyword">const</span> currentUrl = <span class="keyword">this</span>.props.router.currentUrl() || <span class="string">''</span>;</span><br><span class="line">        path &amp;&amp; path !== currentUrl &amp;&amp; item.props.component</span><br><span class="line">        &amp;&amp; self.props.router.pushState(<span class="string">`/<span class="subst">$&#123;path&#125;</span>`</span>, &#123;<span class="attr">path</span>: <span class="string">`/<span class="subst">$&#123;path&#125;</span>`</span>&#125;, () =&gt; &#123;</span><br><span class="line">            self.context.onClickAction(&#123;</span><br><span class="line">                currentPath: path,</span><br><span class="line">                currentComponent: item.props.component</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新 store 示例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    onSubMenuClick = <span class="function">(<span class="params">&#123;key, domEvent&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> store = <span class="keyword">this</span>.context.store;</span><br><span class="line">        <span class="keyword">this</span>.context.onClickAction(&#123;<span class="attr">store</span>: <span class="built_in">Object</span>.assign(store, &#123;[key]: key&#125;)&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    createMenu = <span class="function">(<span class="params">arr = []</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> arr.map &amp;&amp; arr.map(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!val.text) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> key = val.path || Util.generateKey();</span><br><span class="line">                    <span class="keyword">return</span> Util.isArray(val.children) ?</span><br><span class="line">                        &lt;SubMenu</span><br><span class="line">                            key=&#123;key&#125;</span><br><span class="line">                            onTitleClick=&#123;<span class="keyword">this</span>.onSubMenuClick&#125;</span><br><span class="line">                            title=&#123;&lt;span&gt;&#123;val.icon &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">val.icon</span>&#125;`&#125;/&gt;</span>&#125;</span></span><br><span class="line">                                &lt;span&gt;</span><br><span class="line">                                    &#123;val.text&#125;</span><br><span class="line"><span class="xml">                                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>&#125;&gt;</span><br><span class="line">                            &#123;<span class="keyword">this</span>.createMenu(val.children)&#125;</span><br><span class="line">                        &lt;<span class="regexp">/SubMenu&gt;</span></span><br><span class="line"><span class="regexp">                        :</span></span><br><span class="line"><span class="regexp">                        &lt;Menu.Item path=&#123;val.path&#125; key=&#123;key&#125; component=&#123;val.component&#125;&gt;</span></span><br><span class="line"><span class="regexp">                            &#123;val.icon &amp;&amp; &lt;Icon type=&#123;`$&#123;val.icon&#125;`&#125;/</span>&gt;&#125;</span><br><span class="line">                            &lt;span&gt;</span><br><span class="line">                                &#123;val.text&#125;</span><br><span class="line">                            &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;/</span>Menu.Item&gt;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).filter(<span class="function"><span class="params">val</span> =&gt;</span> val !== <span class="literal">undefined</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div className=<span class="string">'logo'</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">                &lt;Menu</span><br><span class="line">                    theme=<span class="string">"dark"</span></span><br><span class="line">                    mode=<span class="string">"inline"</span></span><br><span class="line">                    onClick=&#123;<span class="keyword">this</span>.onMenuClick&#125;</span><br><span class="line">                    style=&#123;&#123;<span class="attr">margin</span>: <span class="string">'16px 0'</span>, <span class="attr">width</span>: <span class="string">'100%'</span>&#125;&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                    &#123;<span class="keyword">this</span>.createMenu(<span class="keyword">this</span>.context.store.menuList)&#125;</span><br><span class="line">                &lt;<span class="regexp">/Menu&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> GYSider;</span><br></pre></td></tr></table></figure>

<h2 id="接入-store-装饰函数-connectStore-js"><a href="#接入-store-装饰函数-connectStore-js" class="headerlink" title="接入 store 装饰函数 connectStore.js"></a>接入 store 装饰函数 connectStore.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">connectStore</span>(<span class="params">Component</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!Component || <span class="keyword">typeof</span> Component !== <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">`<span class="subst">$&#123;Component &amp;&amp; Component.name&#125;</span> is not a class`</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Component.contextTypes = &#123;</span><br><span class="line">        store: PropTypes.object,</span><br><span class="line">        onClickAction: PropTypes.func</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> 上面的入口组建 App</span><br><span class="line"><span class="keyword">import</span> UMD <span class="keyword">from</span> <span class="string">'./UMD'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WrapView</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">let</span> initialState = &#123;</span><br><span class="line">            menuList: [</span><br><span class="line">                &#123;</span><br><span class="line">                    path: <span class="string">'umd'</span>,        <span class="comment">//对应的地址栏 url</span></span><br><span class="line">                    icon: <span class="string">'setting'</span>,    <span class="comment">//侧边栏的显示图标</span></span><br><span class="line">                    text: <span class="string">'umd'</span>,        <span class="comment">//侧边栏的显示文字</span></span><br><span class="line">                    component: UMD      <span class="comment">//点击时对应的右侧内容区组件</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;App initialState=&#123;initialState&#125;/&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> WrapView;</span><br><span class="line"></span><br><span class="line">···</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;render&#125; <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> WrapView <span class="keyword">from</span> <span class="string">'./app/components/WrapView'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Main App View</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">WrapView</span> /&gt;</span>, document.getElementById('app'));</span></span><br></pre></td></tr></table></figure>

<p><strong>核心思路</strong>是通过 context 达到类似于 redux 管理数据的目的，App.js 提供 store（存储数据） 和 onClickAction（修改 store）给子组件，子组件通过 connectStore 装饰函数获取到 store 和 onClickAction，点击侧边栏的时候，先取到设置的 path 和 component，然后通过 onCLickAction 设置 currentComponent 和 currentPath，然后 setState 即可实现需求。<br>目前还有一个问题，就是刷新浏览器的时候如何跳转到相应的页面呢？<br>可以在 App.js 里面先获取到所有的 component 和 path 然后保存起来：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 保存所有的路由对应的组件</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">getAllComponent = <span class="function">(<span class="params">menuList = []</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.allComponent = <span class="keyword">this</span>.allComponent || <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">    menuList.forEach(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (val.path &amp;&amp; Util.isReactComponent(val.component)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.allComponent.set(val.path, val.component);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Util.isArray(val.children)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.getAllComponent(val.children);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再在 App.js 通过以下代码跳转：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">componentWillMount() &#123;</span><br><span class="line">    <span class="comment">// 刷新浏览器，跳转到相应页面</span></span><br><span class="line">    <span class="keyword">const</span> currentPath = <span class="keyword">this</span>.state.currentPath;</span><br><span class="line">    <span class="keyword">const</span> documentHref = <span class="keyword">this</span>.props.router.currentUrl();</span><br><span class="line">    <span class="keyword">if</span> (currentPath !== documentHref &amp;&amp; <span class="keyword">this</span>.allComponent.has(documentHref)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            currentComponent: <span class="keyword">this</span>.allComponent.get(documentHref)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2017/11/08/javascript循环与闭包/">javascript循环与闭包</a><a class="next" href="/2017/07/28/fatal-Could-not-read-from-remote-repository-的解决办法/">fatal: Could not read from remote repository.的解决办法</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/小程序/">小程序</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/">读书笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/04/22/MySQL笔记（一）/">MySQL笔记（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/01/2020Flag/">2020Flag</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/31/2019年终总结/">2019年终总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/12/B端产品经理长成读书笔记/">B端产品经理长成读书笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/19/九败一胜读书笔记/">九败一胜读书笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/08/JavaScript 垃圾收集/">JavaScript 垃圾收集</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/11/roadhog-1-3-X-打包慢的解决办法/">roadhog 1.3.X 打包慢的解决办法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/30/webpack各配置项全解析/">webpack各配置项全解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/小程序和h5页面之间的互相跳转/">小程序和h5页面之间的互相跳转</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/17/微信订阅号开发之获取网页授权/">微信订阅号开发之获取网页授权</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/liangxinwei" title="GitHub" target="_blank">GitHub</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">梁新维.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>