<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>2020Flag</title>
      <link href="/2020/01/01/2020Flag/"/>
      <url>/2020/01/01/2020Flag/</url>
      
        <content type="html"><![CDATA[<h2 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h2><ol><li>Icon 独立为项目（React、Vue）各一份、便于代码复用   DDL：2020-04-30</li><li>看技术书籍、设计书籍、产品书籍   DDL：2020-12-31 一个月一本<ol><li>技术书籍：<ol><li>计算机网络</li><li>软件工程</li></ol></li><li>设计书籍：<ol><li>写给大家看的设计书</li><li>简约至上</li><li>dont make me think</li><li>点石成金</li></ol></li><li>产品书籍：<ol><li>《幕后产品》王诗沐</li><li>《有效需求分析》徐锋</li></ol></li></ol></li><li>学习 TypeScript 并能有配套练习项目   DDL：2020-06-30</li><li>学习Node.js 后台并能有配套练习项目   DDL：2020-12-31，2020-06-30 完成 70%</li><li>学习MySQL、redis、MongoDB并能有配套练习项目   DDL：2020-12-31，2020-06-30 完成 70%</li></ol><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol><li>搭建自己的GitHub Pages博客</li><li>练字，达到字迹美观工整、笔力苍劲</li><li>读一些哲学方面的书</li><li>健身，年中能有8块腹肌</li><li>学英语，单词量20000，不看字母能听懂英文电影</li><li>学习理财相关的知识，开始钱生钱</li></ol>]]></content>
      
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2019年终总结</title>
      <link href="/2019/12/31/2019%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
      <url>/2019/12/31/2019%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>今天是2019年12月31日，眨眼间，2019年过去了。</p><p>时间总是过的很快，尤其是走出象牙塔进入社会之后，刚毕业那会怀揣着简历到处面试的情景仍然记忆犹新。</p><p>这次的年终总结算是2018年到2019年的总结，从我入职现在的公司开始到现在，与我而言，算是很有收获的2年。</p><h2 id="工作上"><a href="#工作上" class="headerlink" title="工作上"></a>工作上</h2><p>这应该是挑战与机遇并存的2年，之前的工作中，我一直是只负责某一部分具体的业务，入职之后，刚开始是写C端小程序、H5活动页面，然后逐步负责公司整个B端相关系统的前端方面的工作，期间遇到过困难、经历过挑战。刚接手B端系统的时候，前同事写的比较随意，代码格式各不一样，维护起来很吃力，不过还好那会业务不算很忙，总算抽出时间重构了最核心的一部分逻辑，并且将打包时间从之前的恐怖的动辄20-30min缩短到2min之内，将webpack版本性能3升级到4，为此领导特意请我喝了一周的☕️，个人感觉还是挺有成就感的一件事。</p><p>团队中也有了新鲜的血液，不同同事之间的代码风格各不一样，如何保证代码质量就成了必须要考虑的一件事，所以我们商讨了一份内部使用的 <code>ESLint</code> 规则，以及<code>code review</code>，有利于以后的维护。</p><p>公司扩张之后，相应的，业务也随之而来，期间和另一位同事（大神）配合搭建起了针对线下各个门店的视频监控系统。第一次涉足视频领域，感觉挺不错。</p><h2 id="工作外围"><a href="#工作外围" class="headerlink" title="工作外围"></a>工作外围</h2><p>随着公司的扩张，随之而来的招人和带新人就成了我工作之余的另一件事，慢慢的学会了怎么样面试别人，在这里特别感谢我的领导，总是在恰当的时间的提点我，令我感觉成长了很多，获益良多。</p><p>另外，得益于用户对移动端办公的迫切需求和小程序的急速发展，公司的B端系统也同步到了小程序上，我作为唯一的开发人员、测试人员、产品人员、UI，从申请小程序到上线第一版以及之后的版本迭代，期间未出现过重大BUG，被领导称做「全干工程师」😓。这样的经历也让我对前端开发有了更深一步的认识与理解，作为最接近用户的程序员，我们应该时刻站在用户的角度思考怎么样能让所开发的产品更易用、更简洁、交互更合理、操作更简单，并且在产品上线之后主动了解用户的反馈，并针对反馈做相应的改进，然后再上线、跟踪反馈、优化，达到整个流程的闭环。这种一个人负责所有的事情对我虽然是第一次，但是开发过程中下意识的思考UI、产品，开发完的测试，上线之后的跟踪反馈，让我耳目一新，原来前端开发人员还可以这样，为此还特意买了设计相关的书籍、B端产品相关的书籍，边看书边开发，美美哒。</p><p>前端团队成长方面，我组织公司的前端同事搭建起了前端团队的自我成长体系，并付诸于行动，每周（最长不超过2周）开一次前端分享（交流）会，包括并不限于JavaScript、CSS、React、Vue、产品、设计相关，相互督促学习，并实践与公司的项目中。以目前的反馈来看，效果挺好。通过学习，我相信不只是我，团队中的任何一位同事，都会在各个方面都有所成长。</p><h2 id="情感上"><a href="#情感上" class="headerlink" title="情感上"></a>情感上</h2><p>今年顺利收获女朋友一枚，工作也有了更大的动力。想给她更好的生活，就得更努力赚钱，努力工作，努力学习，一直成长。</p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>最近因为一些原因，公司也开始了传说中的内部优化，虽然没有波及到研发部门，但是日渐空阔的办公室还是实时提醒着我，<strong>凛冬将至</strong>，这更让我觉得提升自己的能力才是最重要的，在这里告诫大家，一定要有危机意识，居安思危。</p><h2 id="2020年目标"><a href="#2020年目标" class="headerlink" title="2020年目标"></a>2020年目标</h2><p>明天又是新的一年，在这里立几个小目标：</p><ol><li>前端技术方面有大的突破（多阅读源码）</li><li>学习Node.js、MongoDB、MySQL，并能有相应的后台练习项目</li><li>学习产品相关的知识</li><li>学习理财相关的知识，开始钱生钱</li><li>健身，年中能有8块腹肌</li><li>练字，达到字迹美观工整、笔力苍劲</li><li>学习英语，单词量能达到20000，慢英语能听懂</li></ol><h2 id="最后想说"><a href="#最后想说" class="headerlink" title="最后想说"></a>最后想说</h2><p>现在看来，那件事（前端团队的自我成长体系）到现在才运行起来，带给我的教训：<br><strong>要做成一件看起来很难的事，只是缺乏立即去做的决心，和坚持下去的恒心，仅此而已。</strong></p><p>今年对自己整体的评价：<br>技术方面，刚及格，主要是业务太繁忙，又刚交女朋友，学习的时间太少，<br>其他方面，比如UI意识、产品意识等等，还算是比较满意，不再仅仅是前端开发，眼界开阔了不少，业余还看了一些理财方面的书籍，打算来年继续学习。</p><p>2020年，29岁了，希望能有更好的成长。</p>]]></content>
      
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>B端产品经理长成读书笔记</title>
      <link href="/2019/09/12/B%E7%AB%AF%E4%BA%A7%E5%93%81%E7%BB%8F%E7%90%86%E9%95%BF%E6%88%90%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
      <url>/2019/09/12/B%E7%AB%AF%E4%BA%A7%E5%93%81%E7%BB%8F%E7%90%86%E9%95%BF%E6%88%90%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>PMBOK：项目管理知识体系 Project Management Body Of Knowledge</p><p>产品的规则设计：<br>1、精神理念：什么最重要<br>2、目标：产品要达成什么目标<br>3、谁更重要：多方冲突时保护谁<br>4、鼓励什么：什么事再产品中会受到认可和激励<br>5、拒绝什么：什么事不能在产品中做？禁止和惩罚什么？</p><p>方案出错，90%是问题出错了<br>问题-拆解-方案-结论 原则<br>1、定义问题，2、拆解问题，3、导出方案，4、评估得出结论</p><p>更高的时间和行动成本会拉低用户对产品的需求</p><p>RFM模型<br>RFM是最经典的客户消费行为特征分析模型，RFM代表Recency（最近一次消费时间），Frequency（某一个时间范围内的消费频次），Monetary（某一个时间范围内的平均客单价或累计交易额）。根据公司实际数据情况，将这三个指标划分成几档，可以形成多种组合（假设每个指标分五档，则可产生5x5x5个组合），对这些组合进行聚类分析，提炼出行为模式类似的多个群体，实现对客户消费特征的群体细分。</p><p>数据集市 DM Data Mart<br>数据仓库 DW Data Warehouse<br>BI Business Intelligence</p><p>数据仓库和大数据是两个完全不同的概念,它们在理念、技术方案、应用领域方面都完全不同,具体如下。<br>·理念:数据仓库源于交易数据,对数据的准确性要求高,适合做离线分析;大数据源于日志的行为数据,对数据准确性要求不高,适合做自动化策略。<br>技术方案:数据仓库采用传统的、经典的数据分析思路,即抽样、分析、预测;大数据基于海量数据和运算能力,不做抽样而做全量研究,不做分析而做模型应用。<br>应用领域:数据仓库主要用来做企业经营分析;大数据主要用来做各种业务自动化应用。</p><p><img src="/images/141031.png" alt="典型的企业级应用架构图"></p><p><img src="/images/142247.png" alt="支持企业客户销售管理的应用架构图"></p><p><img src="/images/IMG_1982.PNG" alt></p><p><img src="/images/IMG_1983.PNG" alt="战略层"></p><p><img src="/images/IMG_1984.PNG" alt="战略分析工具"></p><p><img src="/images/IMG_1985.PNG" alt="展示层"></p><p><img src="/images/IMG_1986.PNG" alt="执行层-管理层"></p><p><img src="/images/IMG_1987.PNG" alt="执行层-运营层"></p><p><img src="/images/140128.png" alt></p><p><img src="/images/131302.png" alt></p><p><img src="/images/135026.png" alt></p><p><img src="/images/140428.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>九败一胜读书笔记</title>
      <link href="/2019/08/19/%E4%B9%9D%E8%B4%A5%E4%B8%80%E8%83%9C%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
      <url>/2019/08/19/%E4%B9%9D%E8%B4%A5%E4%B8%80%E8%83%9C%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>获取的长期经验不是最重要的，快速学习能力是决定一个人发展现状及未来前景的重要因素。</p><p>总重契约精神，总重大家共同制订好的游戏规则，没有这个，创业就无从谈起。</p><p>CEO不可被人代替的指责是：设计公司整体愿景和所有战略，确保传达给所有利益相关方，不仅是管理层，包括所有员工，不仅是公司内部人，包括股东、消费者、商户和所有合作伙伴；招到并留住最优秀的人；确保公司要有足够的资金。</p><p>以身作则不是塑造公司价值观的最好办法，而是唯一办法。</p><p>把所有东西考虑清楚再去讨论能不能做。</p><p>2004-2009校内网给他们的经验和教训：</p><ol><li>创业团队必须分工明确，CEO必须解放出来，关注整个业界、时代、社会发展的潮流。</li><li>快速推广很重要。</li><li>没有盲目地自我创新，快速学习别人的优点。比如模仿Facebook，在节省成本的同时，让用户有了当时一流的UI体验。</li><li>对资本的看法太过理想化了。应该更早的接触资本，降低姿态，做一些妥协。</li><li>必须和信任的人一起创业。唯有信任才能在遇到低潮的情况下让团队依旧坚持稳固。</li></ol><p>O2O 线上线下：线上交易，线下消费</p><p>保持对未知的世界充满好奇，先把更多的会放进自己的视，才有抉择的余地。</p><p>对于社会能产生真实价值的东西，是事业最稳定的基石。不管这种东西是解决人与人的关系，还是解决人与物的关系。</p><p>互联网时代是”产品为王”的时代，是完美主义者有着系统性优势的时代。只有完美主义的人，才能把产品打磨的那么出色，产品出色，整个公司就赢了。</p><p>任何一个部门，一年只要做对一件事就能获得成功</p><p>招聘进来的人的水准应该比现有团队50%的人高，整个团队才会越来越强</p><p>对未来越有信心，对现在越有耐心。</p><p>一家老有新闻的企业并非好事，在那些枯燥，平凡的日常管理细节里，每天前进一点，日积月累，短期内看不出公司发生了多少变化，把观察时间放长一点，三五年，你就会发现这家公司可能已经脱胎换骨了。这同样适用于每个人。</p><p>未来是不确定的，只能战战兢兢，如履薄冰。</p><p>一如既往的好奇心，超强的学习能力。</p><p>免费的根本问题在于真正的免费如何盈利。</p><p>想要构建产品壁垒，就最好做自己擅长的部分。</p><p>无数平庸的细节堆积出来的，就是平庸的产品。</p><p>如果你希望在一个好的创业公司一路高歌猛进的话，每一年都是关键的一年。</p><p>小公司做起来的关键是抓住了一个机会，中等公司的关键是有一批比较强的高管，大公司的关键是要有正确的流程和价值观。</p><p>企业创始人的价值观决定整个企业其他人对待整个市场的方式。美团网价值观的排序是：消费者第一、商家第二、员工第三、股东第四、王兴第五。</p><p>核心价值观的渗透度越高，整个企业的人员稳定性才越强。公司的使命、愿景、价值观，这些看起来是虚无缥缈的东西，确是团队精神生长的坚实土地。</p><p>CEO履行好自己的指责，其他事情都应该找最专业、最好的人来做。</p><p>团队的组件原则：招进来的人，水准应该比现有团队50%的人高。只要按照这个标准，整个团队会越来越强。</p><p>公司越来越大，为了保障公司的正常运转，需要一套行之有效的组织架构和严密的流程。系统和流程保障了分工明确、权责到位，不易出差错；另一方面却让跨部门合作变得越来越困难，效率在沟通中损耗，创新的热情和机会就有可能在这些损耗中溜掉。</p><p><img src="/images/124117.png" alt="企业家精神"></p>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>roadhog 1.3.X 打包慢的解决办法</title>
      <link href="/2019/06/11/roadhog-1-3-X-%E6%89%93%E5%8C%85%E6%85%A2%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
      <url>/2019/06/11/roadhog-1-3-X-%E6%89%93%E5%8C%85%E6%85%A2%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>背景：公司的后台管理系统项目基于 Antd Pro 早期版本，使用的脚手架是 <a href="https://github.com/sorrycc/roadhog" target="_blank" rel="noopener">roadhog</a>，虽然接入了 dva 等框架，方便了我们把工作重心集中在业务上，但是随着项目的庞大，问题随之而来，首当其冲的就是线上部署的时候打包慢的问题。因为 road 的扩展不太灵活，其本身的初衷就是尽可能减少webpack的配置，所以如何降低打包的速度就成了亟需解决的问题。</p><p>项目依赖58个，打包之后140个文件。</p><p>网上搜了一圈，发现没有令人满意的解决方案，只好自己来解决。仔细缕了一遍思路后发现，还是有解决办法的。</p><p>以下改动仅适用于公司的后台管理系统项目。</p><blockquote><ol><li>删除项目中没有用到或废弃的代码</li><li>利用好 roadhog 支持的 webpack 配置项</li><li>自己改 roadhog 的源码，然后发布为 npm 包，替换掉 roadhog</li></ol></blockquote><p>第一项不用说。</p><p>第二项是设置 webpack 的 externals，由于项目中用到了 g2、d3、echarts、@antv/data-set、moment、g-cloud、g2-plugin-slider、cal-heatmap 等 js 库，所以把它们都配置到 externals 下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"entry"</span>: <span class="string">"src/index.js"</span>,</span><br><span class="line">  <span class="attr">"extraBabelPlugins"</span>: [</span><br><span class="line">    <span class="string">"transform-runtime"</span>,</span><br><span class="line">    <span class="string">"transform-decorators-legacy"</span>,</span><br><span class="line">    <span class="string">"transform-class-properties"</span>,</span><br><span class="line">    [<span class="string">"import"</span>, &#123; <span class="attr">"libraryName"</span>: <span class="string">"antd"</span>, <span class="attr">"libraryDirectory"</span>: <span class="string">"es"</span>, <span class="attr">"style"</span>: <span class="literal">true</span> &#125;]</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"env"</span>: &#123;</span><br><span class="line">    <span class="attr">"development"</span>: &#123;</span><br><span class="line">      <span class="attr">"extraBabelPlugins"</span>: [</span><br><span class="line">        <span class="string">"dva-hmr"</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"externals"</span>: &#123;</span><br><span class="line">    <span class="attr">"g2"</span>: <span class="string">"G2"</span>,</span><br><span class="line">    <span class="attr">"echarts"</span>: <span class="string">"echarts"</span>,</span><br><span class="line">    <span class="attr">"@antv/data-set"</span>: <span class="string">"DataSet"</span>,</span><br><span class="line">    <span class="attr">"moment"</span>: <span class="string">"moment"</span>,</span><br><span class="line">    <span class="attr">"g-cloud"</span>: <span class="string">"Cloud"</span>,</span><br><span class="line">    <span class="attr">"g2-plugin-slider"</span>: <span class="string">"G2.Plugin.slider"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"ignoreMomentLocale"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"theme"</span>: <span class="string">"./src/theme.js"</span>,</span><br><span class="line">  <span class="attr">"hash"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"multipage"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 .eslint.js 将其配置为全局变量：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">"globals": &#123;</span><br><span class="line">  "CalHeatMap": true,</span><br><span class="line">  "DataSet": true,</span><br><span class="line">  "moment": true,</span><br><span class="line">  "echarts": true,</span><br><span class="line">  "G2": true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上注意：</p><ol><li>配置 <code>&quot;multipage&quot;: true</code> 后，roadhog 才会把超过2次引用的依赖打为 common 包</li><li>“dva-hmr” 设置在 development 才会避免生产环境下将其打包，因为生产环境下不会用到</li><li>将这些 js 库文件（不用包涵g-cloud、g2-plugin-slider）下载下来，放到项目根目录下 public/js 下，roadhog 作者约定 public 目录下的文件会在 server 和 build 时被自动 copy 到输出目录（默认是 ./dist）下。所以可以在这里存放 favicon, iconfont, html, html 里引用的图片等。</li><li>手动在 index.ejs 里面将其引入</li></ol><p>第三项</p><p>主要改动的地方：</p><ol><li>common.js 下 HtmlWebpackPlugin 插件配置的地方，给它配置 public 下的所有 js 文件和 css 文件的路径和环境变量：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (existsSync(join(paths.appSrc, <span class="string">'index.ejs'</span>))) &#123;</span><br><span class="line">    <span class="keyword">const</span> scripts = glob.sync(path.resolve(paths.appPublic) + <span class="string">'/js/*.js'</span>).map(<span class="function"><span class="params">filePath</span> =&gt;</span> path.basename(filePath));</span><br><span class="line">    <span class="keyword">const</span> stylesheets = glob.sync(path.resolve(paths.appPublic) + <span class="string">'/stylesheets/*.css'</span>).map(<span class="function"><span class="params">filePath</span> =&gt;</span> path.basename(filePath));</span><br><span class="line">    ret.push(<span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        template: <span class="string">'src/index.ejs'</span>,</span><br><span class="line">        inject: <span class="literal">true</span>,</span><br><span class="line">        scripts,</span><br><span class="line">        stylesheets,</span><br><span class="line">        env: <span class="built_in">JSON</span>.stringify(NODE_ENV)</span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>然后在你的项目的 index.ejs 中引入：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">%</span> <span class="attr">var</span> <span class="attr">stylesheets</span> = <span class="string">htmlWebpackPlugin.options.stylesheets</span> || [] %&gt;</span></span><br><span class="line">  &lt;% for(var i = 0; i &lt; stylesheets.length; i++) &#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&lt;%= 'stylesheets/' + stylesheets[i] %&gt;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">%</span> <span class="attr">var</span> <span class="attr">scripts</span> = <span class="string">htmlWebpackPlugin.options.scripts</span> || [] %&gt;</span></span><br><span class="line">  &lt;% for(var i = 0; i &lt; scripts.length; i++) &#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"&lt;%= 'js/' + scripts[i] %&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>修改 webpack.config.prod.js</li></ol><p>替换 webpack.optimize.UglifyJsPlugin 为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...(debug ? [] : [<span class="keyword">new</span> UglifyJsPlugin(&#123;</span><br><span class="line">    uglifyOptions: &#123;</span><br><span class="line">        compress: &#123;</span><br><span class="line">        warnings: <span class="literal">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    cache: <span class="literal">true</span>,</span><br><span class="line">    sourceMap: <span class="literal">false</span>,</span><br><span class="line">    parallel: <span class="literal">true</span>,</span><br><span class="line">&#125;)]),</span><br></pre></td></tr></table></figure><p>UglifyJsPlugin 的好处不必多说，大家自己 google。</p><p>删掉 webpack.optimize.CommonsChunkPlugin 配置，参考 vue-cli2 的配置项：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (config.multipage) &#123;</span><br><span class="line">    <span class="comment">// Support hash</span></span><br><span class="line">    <span class="keyword">const</span> name = config.hash ? <span class="string">'common.[hash]'</span> : <span class="string">'common'</span>;</span><br><span class="line">    <span class="comment">// ret.push(new webpack.optimize.CommonsChunkPlugin(&#123;</span></span><br><span class="line">    <span class="comment">//   name: 'common',</span></span><br><span class="line">    <span class="comment">//   filename: `$&#123;name&#125;.js`,</span></span><br><span class="line">    <span class="comment">// &#125;));</span></span><br><span class="line">    ret = ret.concat([</span><br><span class="line">      <span class="comment">// split vendor js into its own file</span></span><br><span class="line">      <span class="comment">// 将所有从node_modules中引入的js提取到vendor.js，即抽取库文件</span></span><br><span class="line">      <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">        name: <span class="string">'vendor'</span>,</span><br><span class="line">        minChunks(<span class="built_in">module</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> (<span class="built_in">module</span>.resource &amp;&amp; <span class="regexp">/\.js$/</span>.test(<span class="built_in">module</span>.resource) &amp;&amp; <span class="built_in">module</span>.resource.indexOf(paths.appNodeModules) === <span class="number">0</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// extract webpack runtime and module manifest to its own file in order to</span></span><br><span class="line">      <span class="comment">// prevent vendor hash from being updated whenever app bundle is updated</span></span><br><span class="line">      <span class="comment">// 从vendor中提取出manifest，原因如上</span></span><br><span class="line">      <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">        name: <span class="string">'manifest'</span>,</span><br><span class="line">        minChunks: <span class="literal">Infinity</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// This instance extracts shared chunks from code splitted chunks and bundles them</span></span><br><span class="line">      <span class="comment">// in a separate chunk, similar to the vendor chunk</span></span><br><span class="line">      <span class="comment">// see: https://webpack.js.org/plugins/commons-chunk-plugin/#extra-async-commons-chunk</span></span><br><span class="line">      <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">        name,</span><br><span class="line">        <span class="keyword">async</span>: <span class="string">'vendor-async'</span>,</span><br><span class="line">        children: <span class="literal">true</span>,</span><br><span class="line">        minChunks: <span class="number">3</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，运行 <code>npm run test</code>，<code>npm run build</code>，编译好之后，发布到 npm 仓库如 <a href="https://www.npmjs.com/package/liangxinwei_roadhog" target="_blank" rel="noopener">liangxinwei_roadhog</a>。</p><p>最后，删掉项目下的 package.json 里面 roadhog 相关的依赖，替换为  <code>&quot;liangxinwei_roadhog&quot;: &quot;^1.0.0&quot;</code>：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"devDependencies": &#123;</span><br><span class="line">  - "roadhog": "^1.3.1",</span><br><span class="line">  - "roadhog-api-doc": "^0.1.0",</span><br><span class="line">  + "liangxinwei_roadhog": "^1.0.0",</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>修改启动和打包命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"start"</span>: <span class="string">"node --max_old_space_size=4096 node_modules/liangxinwei_roadhog/lib/server.js"</span>,</span><br><span class="line"><span class="string">"build"</span>: <span class="string">"node --max_old_space_size=4096 node_modules/liangxinwei_roadhog/lib/build.js"</span></span><br></pre></td></tr></table></figure><p>经过我前后的数据比对，修改第二项之后，打包时间由原来的 20-30min 缩减到 5-6min，修改第三项之后，初次打包时间为 3-4min，再次打包时间缩减到 1min 之内。大功告成！</p><p>前端开发长路漫漫，大家且行且珍惜。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>webpack各配置项全解析</title>
      <link href="/2019/01/30/webpack%E5%90%84%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%85%A8%E8%A7%A3%E6%9E%90/"/>
      <url>/2019/01/30/webpack%E5%90%84%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%85%A8%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>以下所以内容摘自<strong>【深入浅出webpack】</strong>，包含每一项的具体配置。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * entry 表示入口, Webpack 执行构建的第一步将从 Entry 开始,可抽象成输入，类型可以是 string、 object、 array</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// 只有 1 个入口,入口只有 1 个文件</span></span><br><span class="line">  entry: <span class="string">' ./app/entry'</span>,</span><br><span class="line">  <span class="comment">// 只有1个入口,入口有两个文件</span></span><br><span class="line">  entry: [<span class="string">'./app/entry1'</span>, <span class="string">'./app/entry2'</span>],</span><br><span class="line">  <span class="comment">// 有两个入口</span></span><br><span class="line">  entry: &#123;</span><br><span class="line">    a: <span class="string">'./app/entry-a'</span>,</span><br><span class="line">    b: [<span class="string">'./app/entry-bl'</span>, <span class="string">'./app/entry-b2'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 如何输出结果 : 在 Webpack 经过一系列处理后,如何输出最终想要的代码</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    <span class="comment">// 输出文件存放的目录,必须是 string 类型的绝对路径</span></span><br><span class="line">    path: path.resolve(dirname, <span class="string">' dist '</span>),</span><br><span class="line">    <span class="comment">// 输出文件的名称</span></span><br><span class="line">    <span class="comment">// 完整的名称</span></span><br><span class="line">    filename: <span class="string">' bundle.js'</span>,</span><br><span class="line">    <span class="comment">// 在配置了多个 entry 时,通过名称模板为不同的 entry 生成不同的文件名称</span></span><br><span class="line">    filename: <span class="string">' [name].js'</span>,</span><br><span class="line">    <span class="comment">// 根据文件内容的 Hash 值生成文件的名称, 用于 浏览器长时间缓存文件</span></span><br><span class="line">    filename: <span class="string">' [chunkhash].js'</span>,</span><br><span class="line">    <span class="comment">// 放到指定目录下</span></span><br><span class="line">    <span class="comment">// 发布到线上的所有资源的 URL 前缀,为 string 类型</span></span><br><span class="line">    publicPath: <span class="string">'/assets/'</span>,</span><br><span class="line">    <span class="comment">// 放到根目录下</span></span><br><span class="line">    publicPath: <span class="string">''</span>,</span><br><span class="line">    <span class="comment">// 放到 CDN 上 // 导出库的名称 , 为 string 类型, 不填它时,默认的输出格式是匿名的立即执行函数</span></span><br><span class="line">    publicPath: <span class="string">'https://cdn.example.com/'</span>,</span><br><span class="line">    library: <span class="string">' MyLibrary '</span>,</span><br><span class="line">    <span class="comment">// 导出库的类型,为枚举类型,默认是 var</span></span><br><span class="line">    <span class="comment">// 可以是umd、 umd2、 commonjs2、 commonjs、 amd、 this、 var、 assign、 window、global、jsonp</span></span><br><span class="line">    libraryTarget: <span class="string">'umd'</span>,</span><br><span class="line">    <span class="comment">// 是否包含有用的文件路径信息到生成的代码里 ,为 boolean 类型</span></span><br><span class="line">    pathinfo: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 附加 Chunk 的文件名称</span></span><br><span class="line">    chunkFilename: <span class="string">'[id].js'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'[chunkhash].js'</span>,</span><br><span class="line">    <span class="comment">// JSONP 异步加载资源时的回调函数名称,需要和服务端搭配使用</span></span><br><span class="line">    jsonpFunction: <span class="string">'myWebpackJsonp'</span>,</span><br><span class="line">    <span class="comment">// 生成的 Source Map 文件的名称</span></span><br><span class="line">    <span class="comment">// 浏览器开发者工具里显示的源码模块名称</span></span><br><span class="line">    sourceMapFilename: <span class="string">'[file].map'</span>,</span><br><span class="line">    <span class="comment">// 异步加载跨域的资源时使用的方式</span></span><br><span class="line">    devtoolModuleFilenameTemplate: <span class="string">'webpack:lll[resource-path]'</span>,</span><br><span class="line">    crossOriginLoading: <span class="string">'use-credentials'</span>,</span><br><span class="line">    crossOriginLoading: <span class="string">'anonymous'</span>,</span><br><span class="line">    crossOriginLoading: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 配置模块相关</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    <span class="comment">// 不用解析和处理的模块，Webpack忽略对部分没采用模块化的文件的递归解析处理，这样做的好处是能提高构建性能</span></span><br><span class="line">    <span class="comment">// 注意，被忽略掉的文件里不应该包含 import、 require、 define 等模块化语句，不\然会导致在构建出的代码中包含无法在浏览器环境下执行的模块化语句。</span></span><br><span class="line">    <span class="comment">//单独、完整的 、react.min.js、文件没有采用模块化，忽略对 、react.min.js、文件 的递归解析处理</span></span><br><span class="line">    noParse: [<span class="regexp">/react\.min\.js$/</span>],</span><br><span class="line">    <span class="comment">// 配置 Loader</span></span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 正则匹配命中要使用 Loader 的文件</span></span><br><span class="line">        test: <span class="regexp">/\.jsx$/</span>,</span><br><span class="line">        <span class="comment">// 只会命中这里面的文件</span></span><br><span class="line">        include: [</span><br><span class="line">          path.resolve(__dirname, <span class="string">'src'</span>)</span><br><span class="line">        ],</span><br><span class="line">        <span class="comment">// 忽略这里面的文件</span></span><br><span class="line">        exclude: [</span><br><span class="line">          path.resolve(__dirname, <span class="string">'node_modules'</span>)</span><br><span class="line">        ],</span><br><span class="line">        <span class="comment">// 使用哪些 Loader,有先后次序,从后向前执行</span></span><br><span class="line">        use: [</span><br><span class="line">          <span class="comment">// style-loader会将 css代码转换成字符串后，注入 JavaScript代码中，通过 JavaScript 向 DOM 增加样式。 如果我们想将 css 代码提取到一个单独的文件中，而不是和 JavaScript 混在 一 起，则可以使用 ExtractTextPlugin</span></span><br><span class="line">          <span class="string">'style-loader'</span>,</span><br><span class="line">          <span class="comment">// css-loader 会找出 css 代码中 eimport 和 url ()这样的导入语句，告诉 Webpack 依赖这些资源 。 同时支持 CSS Modules、压缩 css 等功能 。处理完后再将结果交给 style-loader处理。</span></span><br><span class="line">          <span class="string">'css-loader'</span>,</span><br><span class="line">          <span class="comment">// 通过 sass-loader将 scss 源码转换为 css 代码，再将 css 代码交给 css-loader处理。</span></span><br><span class="line">          <span class="string">'sass-loader'</span>,</span><br><span class="line">          <span class="comment">// 直接使用 Loader 的名称</span></span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            <span class="comment">// 向 html-loader 传一些参数</span></span><br><span class="line">            options: &#123;&#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="comment">// 不用解析和处理的模块，Webpack忽略对部分没采用模块化的文件的递归解析处理，这样做的好处是能提高构建性能</span></span><br><span class="line">        noParse: [</span><br><span class="line">          <span class="comment">// 用正则匹配</span></span><br><span class="line">          /special-library\.js$/</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    plugins: [],</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置寻找模块的规则</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    resolve: &#123;</span><br><span class="line">      <span class="comment">// 寻找模块的根目录,为 array 类型,默认以 node_modules 为根目录</span></span><br><span class="line">      <span class="comment">// 可以指明存放第三方模块的绝对路径，以减少寻找， dirname 表示当前工作目录</span></span><br><span class="line">      modules: [path.resolve(__dirname, <span class="string">'node_modules'</span>)],</span><br><span class="line">      modules: [</span><br><span class="line">        <span class="string">'node modules '</span>,</span><br><span class="line">        path.resolve(__dirname, <span class="string">'app'</span>)</span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">// 模块的后缀名，后缀尝试列表要尽可能小，频率出现最高的文件后缀要优先放在最前面</span></span><br><span class="line">      extensions:</span><br><span class="line">        [<span class="string">'.js'</span>, <span class="string">'json'</span>, <span class="string">'jsx'</span>, <span class="string">'.css'</span>],</span><br><span class="line">      <span class="comment">// 模块别名配置,用于映射模块，从而跳过耗时的递归解析操作。</span></span><br><span class="line">      alias:</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// 将 'module'映射成'new-module' ,同样, 'module/path/file'也会被映射 成'new-module/path/file'</span></span><br><span class="line">          <span class="string">'module'</span>:</span><br><span class="line">            <span class="string">'new-module'</span>,</span><br><span class="line">          <span class="comment">// 使用结尾符号$后 ,将 'only-module' 映射成 'new-module', // 但是不像上面的 ,' module/path/file '不会被映射成' new-module/path/file</span></span><br><span class="line">          <span class="string">'only-module$'</span>: <span class="string">'new-modules'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="comment">// alias 还支持使用数组来更详细地进行配置</span></span><br><span class="line">      alias: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// 老模块</span></span><br><span class="line">          name: <span class="string">'module'</span>,</span><br><span class="line">          <span class="comment">// 新模块</span></span><br><span class="line">          alias: <span class="string">'new-module '</span>,</span><br><span class="line">          <span class="comment">// 是否只映射模块,如果是 true, 则只有' module '会被映射:如果是 false,则'module/inner/path '也会被映射</span></span><br><span class="line">          onlyModule: <span class="literal">true</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">// 是否跟随文件的软链接去搜寻模块的路径</span></span><br><span class="line">      symlinks:</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 模块的描述文件</span></span><br><span class="line">      descriptionFiles:</span><br><span class="line">        [<span class="string">' package.json '</span>],</span><br><span class="line">      <span class="comment">// 模块的描述文件里描述入口的文件的字段名</span></span><br><span class="line">      mainFields:</span><br><span class="line">        [<span class="string">' main '</span>],</span><br><span class="line">      <span class="comment">// 是否强制导入语句写明文件后缀</span></span><br><span class="line">      enforceExtension:</span><br><span class="line">        <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出文件的性能检查配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    performance: &#123;</span><br><span class="line">      <span class="comment">// 有性能问题时输出警告</span></span><br><span class="line">      hints: <span class="string">'warning '</span>,</span><br><span class="line">      <span class="comment">// 有性能问题时输出错误</span></span><br><span class="line">      hints:</span><br><span class="line">        <span class="string">'error '</span>,</span><br><span class="line">      <span class="comment">// 关闭性能检查</span></span><br><span class="line">      hints:</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">// 最大文件的大小(单位为 bytes)</span></span><br><span class="line">      maxAssetSize:</span><br><span class="line">        <span class="number">200000</span>,</span><br><span class="line">      <span class="comment">// 最大入口文件的大小 (单位为 bytes)</span></span><br><span class="line">      maxEntrypointSize:</span><br><span class="line">        <span class="number">400000</span>,</span><br><span class="line">      <span class="comment">// 过滤要检查的文件</span></span><br><span class="line">      assetFilter: <span class="function"><span class="keyword">function</span> (<span class="params">assetFilename</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> assetFilename.endsWith(<span class="string">' .css '</span>) || assetFilename.endsWith(<span class="string">'.js'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 配置 source-map 类型</span></span><br><span class="line">    devtool: <span class="string">' source-map '</span>,</span><br><span class="line">    <span class="comment">// Webpack 使用的根目录, string 类型必须是绝对路径 //  配置输出代码的运行环境</span></span><br><span class="line">    context:</span><br><span class="line">    __dirname,</span><br><span class="line">    <span class="comment">// 浏览器,默认</span></span><br><span class="line">    target:</span><br><span class="line">      <span class="string">'web'</span>,</span><br><span class="line">    <span class="comment">// WebWorker</span></span><br><span class="line">    target:</span><br><span class="line">      <span class="string">'webworker'</span>,</span><br><span class="line">    <span class="comment">// Node.js,使用 、require、语句加载 Chunk代码 target:'async-node', II Node.js,异步加载 Chunk代码</span></span><br><span class="line">    target:</span><br><span class="line">      <span class="string">'node'</span>,</span><br><span class="line">    <span class="comment">// nw.js</span></span><br><span class="line">    target:</span><br><span class="line">      <span class="string">'node-webkit'</span>,</span><br><span class="line">    <span class="comment">// electron,主线程</span></span><br><span class="line">    target:</span><br><span class="line">      <span class="string">'electron-main'</span>,</span><br><span class="line">    <span class="comment">// electron,渲染线程</span></span><br><span class="line">    target:</span><br><span class="line">      <span class="string">'electron-renderer'</span>,</span><br><span class="line">    <span class="comment">// 使用来自 JavaScript 运行环境提供的全局变量</span></span><br><span class="line">    externals: &#123;</span><br><span class="line">        jquery: <span class="string">'jQuery'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 控制台输出日志控制</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    stats: &#123;</span><br><span class="line">      assets: <span class="literal">true</span>,</span><br><span class="line">      colors:</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">      errors:</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">      errorDetails:</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">      hash:</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * DevServer 相关的配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">      <span class="comment">// 代理到后端服务接口</span></span><br><span class="line">      proxy: &#123;</span><br><span class="line">        <span class="string">'/api'</span>:</span><br><span class="line">          <span class="string">'http:// localhost:3000'</span></span><br><span class="line">      &#125;</span><br><span class="line">      ,</span><br><span class="line">      <span class="comment">// 配置 DevServer HTTP 服务器的文 件根目录</span></span><br><span class="line">      contentBase: path.join(__dirname, <span class="string">'public'</span>),</span><br><span class="line">      <span class="comment">// 是否开启 Gzip 压缩</span></span><br><span class="line">      compress:</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 是否开发 HTMLS History API 网页</span></span><br><span class="line">      historyApiFallback:</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 是否开启模块热替换功能</span></span><br><span class="line">      hot:</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 是否开启 HTTPS 模式</span></span><br><span class="line">      https:</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">// 是否捕捉 Webpack构建的性能信息,用于分析是什么原因导致构建性能不佳</span></span><br><span class="line">      profile:</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 是否启用缓存来提升构建速度</span></span><br><span class="line">      cache:</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">// 是否开始</span></span><br><span class="line">      watch:</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 监听模式选项</span></span><br><span class="line">      <span class="comment">// 不监听的文件或文件夹,支持正则匹配。默认为空</span></span><br><span class="line">      watchOptions: &#123;</span><br><span class="line">        ignored: <span class="regexp">/node modules/</span>,</span><br><span class="line">        <span class="comment">// 监听到变化发生后,等 300ms 再执行动作,截流,防止文件更新太快导致重新编 译频率太快。默认为 300ms</span></span><br><span class="line">        aggregateTimeout: <span class="number">300</span>,</span><br><span class="line">        <span class="comment">// 不停地询问系统指定的文件有没有发生变化,默认每秒询问 1000 次</span></span><br><span class="line">        poll: <span class="number">1000</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>小程序和h5页面之间的互相跳转</title>
      <link href="/2018/10/23/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%92%8Ch5%E9%A1%B5%E9%9D%A2%E4%B9%8B%E9%97%B4%E7%9A%84%E4%BA%92%E7%9B%B8%E8%B7%B3%E8%BD%AC/"/>
      <url>/2018/10/23/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%92%8Ch5%E9%A1%B5%E9%9D%A2%E4%B9%8B%E9%97%B4%E7%9A%84%E4%BA%92%E7%9B%B8%E8%B7%B3%E8%BD%AC/</url>
      
        <content type="html"><![CDATA[<h2 id="小程序跳转到-h5-页面"><a href="#小程序跳转到-h5-页面" class="headerlink" title="小程序跳转到 h5 页面"></a>小程序跳转到 h5 页面</h2><p>小程序代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wx.navigateTo(&#123;url: &apos;/pages/webview?url=&apos; + encodeURIComponent(&apos;h5页面的 url&apos;)&#125;);</span><br></pre></td></tr></table></figure><p>webview.js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;web-view src=&quot;&#123;&#123;url&#125;&#125;&quot; bindmessage=&quot;handlePostMessage&quot;&gt;&lt;/web-view&gt;</span><br><span class="line"></span><br><span class="line">onLoad: function (options) &#123;</span><br><span class="line"> this.setData(&#123;</span><br><span class="line">   url: decodeURIComponent(options.url),</span><br><span class="line"> &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">// 接收 h5 页面传递过来的参数</span><br><span class="line">handlePostMessage: function (e) &#123;</span><br><span class="line">  const data = e.detail;</span><br><span class="line">  console.log(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>h5 页面代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;</span><br><span class="line">···</span><br><span class="line">  &lt;script type=&quot;text/javascript&quot; src=&quot;https://res.wx.qq.com/open/js/jweixin-1.3.2.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br></pre></td></tr></table></figure><p>记得把 url 的 host 添加到后台的合法域名中。</p><h2 id="h5-页面跳回小程序"><a href="#h5-页面跳回小程序" class="headerlink" title="h5 页面跳回小程序"></a>h5 页面跳回小程序</h2><p>在 h5 页面的任何点击事件中：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/* eslint-disable */</span><br><span class="line"> wx.miniProgram.getEnv(function (res) &#123;</span><br><span class="line">   if (res.miniprogram) &#123;</span><br><span class="line">     wx.miniProgram.switchTab(&#123;url: &apos;/pages/home/home&apos;&#125;);</span><br><span class="line"> wx.miniProgram.postMessage(&#123;data: &#123;id: &apos;1234&apos;&#125;&#125;); // 传的参数</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;);</span><br><span class="line"> /* eslint-enable */</span><br></pre></td></tr></table></figure><p>请注意，<strong>是wx.miniProgram，不是 window.wx.miniProgram</strong></p>]]></content>
      
      
      <categories>
          
          <category> 小程序 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>微信订阅号开发之获取网页授权</title>
      <link href="/2018/10/17/%E5%BE%AE%E4%BF%A1%E8%AE%A2%E9%98%85%E5%8F%B7%E5%BC%80%E5%8F%91%E4%B9%8B%E8%8E%B7%E5%8F%96%E7%BD%91%E9%A1%B5%E6%8E%88%E6%9D%83/"/>
      <url>/2018/10/17/%E5%BE%AE%E4%BF%A1%E8%AE%A2%E9%98%85%E5%8F%B7%E5%BC%80%E5%8F%91%E4%B9%8B%E8%8E%B7%E5%8F%96%E7%BD%91%E9%A1%B5%E6%8E%88%E6%9D%83/</url>
      
        <content type="html"><![CDATA[<p>题记：项目（Vue）是h5页面，主要用于公众号里面的活动，目的是增加公众号关注人数，达到推广的目的，其中涉及到获取用户的昵称、头像、unionid等基本信息。<br>由于微信公众号改版成订阅号之后，并没有获取用户信息的接口，服务号才有，详情可查看<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1421140842" target="_blank" rel="noopener">官方文档</a><br>所以目前想到的思路是借用和订阅号关联的服务号获取 code，然后利用获取到的code 发送给后端再请求用户信息。<br>首先，在 App.vue 的 created 中获取 code：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;getUserOpenId&#125; <span class="keyword">from</span> <span class="string">'./utils'</span>;</span><br><span class="line"></span><br><span class="line">created() &#123;</span><br><span class="line">  <span class="keyword">this</span>.getUserInfo();</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">  getUserInfo(reRequest = <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> answerId = location.hash.startsWith(<span class="string">'#/degenerate-test/result'</span>) &amp;&amp; Util.getURLHashParameter(<span class="string">'answerId'</span>);</span><br><span class="line">    getUserOpenId(!answerId ? <span class="string">'degenerate-test'</span> : <span class="string">'degenerate-test/result'</span>, !answerId ? <span class="string">''</span> : <span class="string">`answerId=<span class="subst">$&#123;answerId&#125;</span>`</span>, reRequest);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中，getUserOpenId 为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取 code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">routePath</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">queryParam</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCodeUrl</span>(<span class="params">routePath = <span class="string">''</span>, queryParam</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> url = <span class="string">`<span class="subst">$&#123;location.protocol&#125;</span>//<span class="subst">$&#123;location.host&#125;</span>/h5/`</span>;</span><br><span class="line">  url += routePath ? <span class="string">`#/<span class="subst">$&#123;routePath&#125;</span>`</span> : <span class="string">''</span>;</span><br><span class="line">  url += queryParam ? <span class="string">`?<span class="subst">$&#123;queryParam&#125;</span>`</span> : <span class="string">''</span>;</span><br><span class="line">  url = <span class="built_in">encodeURIComponent</span>(url);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'url:'</span>, url);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'redirect url:'</span>, <span class="string">`https://open.weixin.qq.com/connect/oauth2/authorize?appid=<span class="subst">$&#123;APP_ID&#125;</span>&amp;redirect_uri=<span class="subst">$&#123;url&#125;</span>&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=STATE#wechat_redirect`</span>);</span><br><span class="line">  <span class="built_in">window</span>.location.href = <span class="string">`https://open.weixin.qq.com/connect/oauth2/authorize?appid=<span class="subst">$&#123;APP_ID&#125;</span>&amp;redirect_uri=<span class="subst">$&#123;url&#125;</span>&amp;response_type=code&amp;scope=snsapi_userinfo&amp;connect_redirect=1&amp;state=<span class="subst">$&#123;<span class="built_in">Math</span>.random().toString(<span class="number">16</span>).substr(<span class="number">-6</span>)&#125;</span>#wechat_redirect`</span>;</span><br><span class="line">  <span class="comment">// 因为 code 只能使用一次，所以为了确保每次请求到的 code 都是有效的值，此处设置 state 参数为 随机字符串</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取 user openId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">routePath</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">queryParam</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">reRequest</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserOpenId</span>(<span class="params">routePath, queryParam, reRequest</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> existedUnionId = localStorage.getItem(<span class="string">'userUnionId'</span>);</span><br><span class="line">  <span class="keyword">if</span> (existedUnionId) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'有 union_id:'</span>, existedUnionId, <span class="string">', 不发请求'</span>);</span><br><span class="line">    user.actions.setUnionId(store, existedUnionId);</span><br><span class="line">    <span class="keyword">new</span> EventManager().trigger(<span class="string">'onUserInfoReady'</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> code = Util.getUrlSearchParameter(<span class="string">'code'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'code'</span>, code);</span><br><span class="line">  <span class="keyword">if</span> (code &amp;&amp; !reRequest) &#123;</span><br><span class="line">    axiosInstance.post(Url.USER_INFO, &#123;code&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'用户信息 data'</span>, res);</span><br><span class="line">      res.telephone != <span class="literal">null</span> &amp;&amp; user.actions.setTelephoneNumber(store, res.telephone);</span><br><span class="line">      res.openid != <span class="literal">null</span> &amp;&amp; user.actions.setOpenId(store, res.openid);</span><br><span class="line">      res.unionid != <span class="literal">null</span> &amp;&amp; user.actions.setUnionId(store, res.unionid);</span><br><span class="line">      res.nickname != <span class="literal">null</span> &amp;&amp; user.actions.setNickname(store, res.nickname);</span><br><span class="line">      res.headimgurl != <span class="literal">null</span> &amp;&amp; user.actions.setHeadImgUrl(store, res.headimgurl);</span><br><span class="line">      <span class="keyword">new</span> EventManager().trigger(<span class="string">'onUserInfoReady'</span>);</span><br><span class="line">    &#125;).catch(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'获取用户信息出错,'</span>, res);</span><br><span class="line">      Vue.prototype.$toast((res &amp;&amp; res.msg) || <span class="string">'您的授权信息有误，请退出之后重新进入'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'没有 code 或者 code 被使用过，微信即将重定向'</span>);</span><br><span class="line">    getCodeUrl(routePath, queryParam);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的 APP_ID 即为服务号的 app_id，然后微信会做一次重定向，出现授权弹框页点击授权之后，微信会将 code 以 URL 中 search 的形式传回，前端获取到 code 之后即可发给后端，后端拿到 code 之后，即可返回用户的信息，这个过程比较漫长，应为后端需要向微信获取信息，大概500ms，获取到之后，可以把 unionid 缓存下来，这样以后就不应频繁的请求了。要注意一个问题，因为获取用户信息是一个比较耗时的过程，所以如果活动主页（如 home.vue）有需要用 unionid 作为参数的请求的话，可能用户信息请求还没结束，home.vue 的 mounted 已经执行完毕了，所以会有 unionid 还未取到的情况出现，此处要注意。我使用的是事件管理器（最后面会写出来），等确保获取到 unionid 之后，事件管理器触发活动首页的请求，如果没有 unionid 的话，会重新走一遍上面的流程，先获取 code，然后再重新请求用户信息，这样能确保不会发生 unionid 为 null 的情况。<br>ps: Vue 的执行顺序为 App created -&gt; home created -&gt; home mounted -&gt; app mounted<br>但如果 home.vue 使用的是动态路由加载的话，就不是这个顺序了，此处要特别注意。<br>home：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  ...mapGetters([<span class="string">'unionId'</span>])</span><br><span class="line">&#125;,</span><br><span class="line">mounted() &#123;</span><br><span class="line">  <span class="keyword">new</span> EventManager().on(<span class="string">'onUserInfoReady'</span>, <span class="keyword">this</span>.checkUnionId);</span><br><span class="line">&#125;,</span><br><span class="line">beforeDestroy() &#123;</span><br><span class="line">  <span class="keyword">new</span> EventManager().off(<span class="string">'onUserInfoReady'</span>);</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">  checkUnionId() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'发送请求之前，unionId：'</span>, <span class="keyword">this</span>.unionId);</span><br><span class="line">    <span class="comment">// this.$parent 即为 App.vue</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.unionId &amp;&amp; <span class="keyword">this</span>.$parent.getUserInfo) &#123;</span><br><span class="line">      <span class="keyword">this</span>.$toast(<span class="string">'获取信息中···'</span>);</span><br><span class="line">      <span class="keyword">this</span>.$parent.getUserInfo(<span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.requestData(); <span class="comment">// 可利用 unionid 请求数据</span></span><br><span class="line">&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">async</span> requestData() &#123;</span><br><span class="line">    <span class="comment">// balabalabala</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面为 EventManager</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用全局事件管理器 单例模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> instance;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventManager</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> (!instance) &#123;</span><br><span class="line">      <span class="keyword">this</span>.onObj = &#123;&#125;;</span><br><span class="line">      <span class="keyword">this</span>.oneObj = &#123;&#125;;</span><br><span class="line">      instance = <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 使用 on 进行订阅的函数，每次事件发生响应时都会被触发</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  on(key, fun) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key &amp;&amp; fun &amp;&amp; <span class="keyword">typeof</span> key === <span class="string">'string'</span> &amp;&amp; <span class="keyword">typeof</span> fun === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.onObj[key] = <span class="keyword">this</span>.onObj[key] || [];</span><br><span class="line">      <span class="keyword">this</span>.onObj[key].push(fun);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'incorrect parameters: the type of parameter key must be string, and the type of parameter fun must be function'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 使用 one 进行订阅的函数，只会触发一次</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  one(key, fun) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key &amp;&amp; fun &amp;&amp; <span class="keyword">typeof</span> key === <span class="string">'string'</span> &amp;&amp; <span class="keyword">typeof</span> fun === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.oneObj[key] = <span class="keyword">this</span>.oneObj[key] || [];</span><br><span class="line">      <span class="keyword">this</span>.oneObj[key].push(fun);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'incorrect parameters: the type of parameter key must be string, and the type of parameter fun must be function'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 解除所有订阅了某个事件的所有函数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  off(key) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key &amp;&amp; <span class="keyword">typeof</span> key === <span class="string">'string'</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.oneObj[key] = [];</span><br><span class="line">      <span class="keyword">this</span>.onObj[key] = [];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'incorrect parameters: the type of parameter key must be string'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 解除所有</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  offAll() &#123;</span><br><span class="line">    <span class="keyword">this</span>.oneObj = &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>.onObj = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用于发布者发布事件，将除第一参数（事件名）的其他参数，作为新的参数，触发使用 one 与 on 进行订阅的函数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  trigger(key, ...args) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key &amp;&amp; <span class="keyword">typeof</span> key === <span class="string">'string'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.onObj[key] !== <span class="literal">undefined</span> &amp;&amp; <span class="keyword">this</span>.onObj[key].length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.onObj[key].forEach(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">          v.apply(<span class="literal">null</span>, args);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.oneObj[key] !== <span class="literal">undefined</span> &amp;&amp; <span class="keyword">this</span>.oneObj[key].length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.oneObj[key].forEach(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">          v.apply(<span class="literal">null</span>, args);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">this</span>.oneObj[key] = [];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'incorrect parameters: the type of parameter key must be string'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> EventManager;</span><br></pre></td></tr></table></figure><p>最后，贴一个我自己搭的<a href="https://github.com/liangxinwei/vue-basic-framework" target="_blank" rel="noopener">通用公众号网页开发 Vue 项目框架</a></p>]]></content>
      
      
      <categories>
          
          <category> 小程序 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>浏览器/iframe 全屏、退出全屏</title>
      <link href="/2018/08/15/%E6%B5%8F%E8%A7%88%E5%99%A8-iframe-%E5%85%A8%E5%B1%8F%E3%80%81%E9%80%80%E5%87%BA%E5%85%A8%E5%B1%8F/"/>
      <url>/2018/08/15/%E6%B5%8F%E8%A7%88%E5%99%A8-iframe-%E5%85%A8%E5%B1%8F%E3%80%81%E9%80%80%E5%87%BA%E5%85%A8%E5%B1%8F/</url>
      
        <content type="html"><![CDATA[<p>外面的 html 文件 index.html：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;fullScreen&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        body &#123;</span><br><span class="line">            margin: 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;iframe allowfullscreen src=&quot;iframe.html&quot; frameborder=&quot;0&quot; style=&quot;width: 500px;height: 500px;background:#aaa&quot;&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>里面嵌套的 iframe.html 文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;iframe&lt;/h1&gt;</span><br><span class="line">    &lt;button id=&quot;button&quot;&gt;全屏&lt;/button&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        // 判断是否允许全屏</span><br><span class="line">        var fullscreenEnabled =</span><br><span class="line">            document.fullscreenEnabled ||</span><br><span class="line">            document.mozFullScreenEnabled ||</span><br><span class="line">            document.webkitFullscreenEnabled ||</span><br><span class="line">            document.msFullscreenEnabled;</span><br><span class="line">        // 全屏</span><br><span class="line">        function launchFullscreen(element) &#123;</span><br><span class="line">            if (element.requestFullscreen) &#123;</span><br><span class="line">                element.requestFullscreen();</span><br><span class="line">            &#125; else if (element.mozRequestFullScreen) &#123;</span><br><span class="line">                element.mozRequestFullScreen();</span><br><span class="line">            &#125; else if (element.msRequestFullscreen) &#123;</span><br><span class="line">                element.msRequestFullscreen();</span><br><span class="line">            &#125; else if (element.webkitRequestFullscreen) &#123;</span><br><span class="line">                element.webkitRequestFullScreen();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // 退出全屏</span><br><span class="line">        function exitFullscreen() &#123;</span><br><span class="line">            if (document.exitFullscreen) &#123;</span><br><span class="line">                document.exitFullscreen();</span><br><span class="line">            &#125; else if (document.msExitFullscreen) &#123;</span><br><span class="line">                document.msExitFullscreen();</span><br><span class="line">            &#125; else if (document.mozCancelFullScreen) &#123;</span><br><span class="line">                document.mozCancelFullScreen();</span><br><span class="line">            &#125; else if (document.webkitExitFullscreen) &#123;</span><br><span class="line">                document.webkitExitFullscreen();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        var btn = document.querySelector(&apos;#button&apos;);</span><br><span class="line">        if (fullscreenEnabled) &#123;</span><br><span class="line">            btn.addEventListener(&apos;click&apos;, function () &#123;</span><br><span class="line">                var fullscreenElement =</span><br><span class="line">                    document.fullscreenElement ||</span><br><span class="line">                    document.mozFullScreenElement ||</span><br><span class="line">                    document.webkitFullscreenElement;</span><br><span class="line">                if (fullscreenElement) &#123;</span><br><span class="line">                    exitFullscreen();</span><br><span class="line">                    btn.innerHTML = &apos;全屏&apos;;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    launchFullscreen(document.documentElement);</span><br><span class="line">                    btn.innerHTML = &apos;退出全屏&apos;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, false);</span><br><span class="line">        &#125;</span><br><span class="line">        // 监听全屏事件</span><br><span class="line">        document.addEventListener(&apos;webkitfullscreenchange&apos;, function fullscreenChange() &#123;</span><br><span class="line">            if (document.fullscreenEnabled ||</span><br><span class="line">                document.webkitIsFullScreen ||</span><br><span class="line">                document.mozFullScreen ||</span><br><span class="line">                document.msFullscreenElement) &#123;</span><br><span class="line">                console.log(&apos;enter fullscreen&apos;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                console.log(&apos;exit fullscreen&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, false);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>javaweb常见HTTP状态码</title>
      <link href="/2017/12/23/javaweb%E5%B8%B8%E8%A7%81HTTP%E7%8A%B6%E6%80%81%E7%A0%81/"/>
      <url>/2017/12/23/javaweb%E5%B8%B8%E8%A7%81HTTP%E7%8A%B6%E6%80%81%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><ol><li>404 -Not Found 代表客户端错误，指的是服务器端无法找到所请求的资源</li><li>400 -请求无效，服务器不理解请求的语法</li><li>403 - 禁止访问 ，服务器拒绝请求</li><li>405 - 资源被禁止，禁用请求中指定的方法</li><li>406 - 无法接受 ，无法使用请求的内容特性响应请求的网页</li><li>407 - 要求代理身份验证 ，此状态代码与 401（未授权）类似，但指定请求者应当授权使用代理</li><li>408 - 请求超时，服务器等候请求时发生超时</li><li>409 - 冲突，服务器在完成请求时发生冲突。 服务器必须在响应中包含有关冲突的信息</li><li>410 - 已删除，如果请求的资源已永久删除，服务器就会返回此响应。</li><li>411 - 需要有效长度， 服务器不接受不含有效内容长度标头字段的请求。</li><li>412 - 未满足前提条件， 服务器未满足请求者在请求中设置的其中一个前提条件。</li><li>413 - 请求实体过大，服务器无法处理请求，因为请求实体过大，超出服务器的处理能力。</li><li>414 - 请求的 URI 过长， 请求的 URI（通常为网址）过长，服务器无法处理。</li><li>415 - 不支持的媒体类型， 请求的格式不受请求页面的支持。</li><li>416 - 请求范围不符合要求，如果页面无法提供请求的范围，则服务器会返回此状态代码。</li><li>417 - 未满足期望值，服务器未满足”期望”请求标头字段的要求</li><li>500 - 内部服务器错误，无法完成请求</li><li>501 - 未实现 ，服务器不具备完成请求的功能。 例如，服务器无法识别请求方法时可能会返回此代码</li><li>502 - 网关错误 ，服务器作为网关或代理，从上游服务器收到无效响应</li><li>503 - 服务不可用，服务器目前无法使用，通常，这只是暂时状态</li><li>504 - 网关超时， 服务器作为网关或代理，但是没有及时从上游服务器收到请求</li><li>505 - HTTP 版本不受支持， 服务器不支持请求中所用的 HTTP 协议版本</li></ol><h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><ol><li>2xx - 客户端请求已成功。 <ol><li>200 - 服务器已成功处理了请求。 通常，这表示服务器提供了请求的网页</li><li>201 - 已创建，请求成功并且服务器创建了新的资源</li><li>202 - 已接受，但尚未处理</li><li>203 - 非权威性信息，服务器已成功处理了请求，但返回的信息可能来自另一来源</li><li>204 - 无内容，服务器成功处理了请求，但没有返回任何内容</li><li>205 - 重置内容，服务器成功处理了请求，但没有返回任何内容</li><li>206 - 部分内容，服务器成功处理了部分 GET 请求</li></ol></li><li>3xx - 重定向 <ol><li>302 - 对象已移动</li><li>304 - 未修改</li><li>307 - 临时重定向</li></ol></li></ol><p><strong>附上全部状态码：</strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status" target="_blank" rel="noopener">HTTP response codes</a></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>javascript循环与闭包</title>
      <link href="/2017/11/08/javascript%E5%BE%AA%E7%8E%AF%E4%B8%8E%E9%97%AD%E5%8C%85/"/>
      <url>/2017/11/08/javascript%E5%BE%AA%E7%8E%AF%E4%B8%8E%E9%97%AD%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<p>当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使函数是在当前词法作用域之外执行。</p><p>下面我们来看一段代码，清晰地展示了闭包：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function foo() &#123;</span><br><span class="line">    var a = 2;</span><br><span class="line">    function bar() &#123;</span><br><span class="line">        console.log(a);</span><br><span class="line">    &#125;</span><br><span class="line">    return bar;</span><br><span class="line">&#125;</span><br><span class="line">var baz = foo();</span><br><span class="line">baz(); // 2 —— 这就是闭包的效果。</span><br></pre></td></tr></table></figure><p>函数 bar() 的词法作用域能够访问 foo() 的内部作用域。然后我们将 bar() 函数本身当作一个值类型进行传递。在这个例子中，我们将 bar 所引用的函数对象本身当作返回值。在 foo() 执行后，其返回值（也就是内部的 bar() 函数）赋值给变量 baz 并调用 baz() ，实际上只是通过不同的标识符引用调用了内部的函数 bar() 。bar() 显然可以被正常执行。但是在这个例子中，它<strong>在自己定义的词法作用域以外的地方执行</strong>。在 foo() 执行后，通常会期待 foo() 的整个内部作用域都被销毁，因为我们知道引擎有垃圾回收器用来释放不再使用的内存空间。由于看上去 foo() 的内容不会再被使用，所以很自然地会考虑对其进行回收。而闭包的“神奇”之处正是可以阻止这件事情的发生。事实上内部作用域依然存在，因此没有被回收。谁在使用这个内部作用域？原来是 bar() 本身在使用。拜 bar() 所声明的位置所赐，它拥有涵盖 foo() 内部作用域的闭包，使得该作用域能够一直存活，以供 bar() 在之后任何时间进行引用。bar() 依然持有对该作用域的引用，而这个引用就叫作闭包。</p><p>这个函数在定义时的词法作用域以外的地方被调用。闭包使得函数可以继续访问定义时的词法作用域。</p><p>要说明闭包， for 循环是最常见的例子。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 1; i &lt;= 5; i++) &#123;</span><br><span class="line">    setTimeout(function timer() &#123;</span><br><span class="line">        console.log(i);</span><br><span class="line">    &#125;, i * 1000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>正常情况下，我们对这段代码行为的预期是分别输出数字 1~5，每秒一次，每次一个。但实际上，这段代码在运行时会以每秒一次的频率输出五次 6。</p><p>仔细想一下，延迟函数的回调会在循环结束时才执行。事实上，当定时器运行时即使每个迭代中执行的是 setTimeout(.., 0) ，所有的回调函数依然是在循环结束后才会被执行，因此会每次输出一个 6 出来。</p><p><strong>缺陷是我们试图假设循环中的每个迭代在运行时都会给自己“捕获”一个 i 的副本。但是根据作用域的工作原理，实际情况是尽管循环中的五个函数是在各个迭代中分别定义的，但是它们都被封闭在一个共享的全局作用域中，因此实际上只有一个 i 。</strong></p><p>我们来试一下通过声明并立即执行一个函数来创建作用域</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 1; i &lt;= 5; i++) &#123;</span><br><span class="line">    (function () &#123;</span><br><span class="line">        setTimeout(function timer() &#123;</span><br><span class="line">            console.log(i);</span><br><span class="line">        &#125;, i * 1000);</span><br><span class="line">    &#125;)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样不行。但是为什么呢？我们现在显然拥有更多的词法作用域了。的确每个延迟函数都会将 IIFE（立即执行函数表达式） 在每次迭代中创建的作用域封闭起来。如果作用域是空的，那么仅仅将它们进行封闭是不够的。仔细看一下，我们的 IIFE 只是一个什么都没有的空作用域。它需要包含一点实质内容才能为我们所用。它需要有自己的变量，用来在每个迭代中储存 i 的值：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 1; i &lt;= 5; i++) &#123;</span><br><span class="line">    (function () &#123;</span><br><span class="line">        var j = i;</span><br><span class="line">        setTimeout(function timer() &#123;</span><br><span class="line">            console.log(j);</span><br><span class="line">        &#125;, j * 1000);</span><br><span class="line">    &#125;)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>行了！它能正常工作了！。</p><p>可以对这段代码进行一些改进：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 1; i &lt;= 5; i++) &#123;</span><br><span class="line">    (function (j) &#123;</span><br><span class="line">        setTimeout(function timer() &#123;</span><br><span class="line">            console.log(j);</span><br><span class="line">        &#125;, j * 1000);</span><br><span class="line">    &#125;)(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在迭代内使用 IIFE 会为每个迭代都生成一个新的作用域，使得延迟函数的回调可以将新的作用域封闭在每个迭代内部，每个迭代中都会含有一个具有正确值的变量供我们访问。</p><p>仔细思考我们对前面的解决方案的分析。我们使用 IIFE 在每次迭代时都创建一个新的作用域。换句话说，每次迭代我们都需要一个块作用域。 let 声明，可以用来劫持块作用域，并且在这个块作用域中声明一个变量。本质上这是将一个块转换成一个可以被关闭的作用域。因此，下面的代码可以正常运行了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 1; i &lt;= 5; i++) &#123;</span><br><span class="line">    let j = i; // 是的，闭包的块作用域！</span><br><span class="line">    setTimeout(function timer() &#123;</span><br><span class="line">        console.log(j);</span><br><span class="line">    &#125;, j * 1000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是，这还不是全部！for 循环头部的 let 声明还会有一个特殊的行为。这个行为指出变量在循环过程中不止被声明一次，每次迭代都会声明。随后的每个迭代都会使用上一个迭代结束时的值来初始化这个变量。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for (let i = 1; i &lt;= 5; i++) &#123;</span><br><span class="line">    setTimeout(function timer() &#123;</span><br><span class="line">        console.log(i);</span><br><span class="line">    &#125;, i * 1000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样，问题解决了！</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>记一次管理系统和路由系统的整合</title>
      <link href="/2017/09/28/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%92%8C%E8%B7%AF%E7%94%B1%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%95%B4%E5%90%88/"/>
      <url>/2017/09/28/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%92%8C%E8%B7%AF%E7%94%B1%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%95%B4%E5%90%88/</url>
      
        <content type="html"><![CDATA[<h2 id="需求：整合管理系统和路由系统"><a href="#需求：整合管理系统和路由系统" class="headerlink" title="需求：整合管理系统和路由系统"></a>需求：整合管理系统和路由系统</h2><h2 id="UI："><a href="#UI：" class="headerlink" title="UI："></a>UI：</h2><p>同 <a href="https://preview.pro.ant.design/" target="_blank" rel="noopener">Ant Design Pro</a> </p><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>由于左侧管理菜单内容在运行时才能确定，而且点击菜单要和右侧内容区联动，地址栏也要有相应的改变，而目前已有的路由系统都是要运行之前要确定具体的路由组建，因此采用 h5 的 history 和 传统的 document.location 结合的方式实现路由系统；整个项目的数据管理则因为考虑到左侧菜单对应的组件可能会使用包括 redux/mbox/dva/kao 之类的框架，如果也使用框架的话，可能会引起冲突，故通过 react 的 context 来实现。</p><h2 id="路由系统-router-js"><a href="#路由系统-router-js" class="headerlink" title="路由系统 router.js"></a>路由系统 router.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> instance = <span class="literal">undefined</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (!instance) &#123;</span><br><span class="line">            <span class="keyword">this</span>.history = <span class="built_in">window</span>.history;</span><br><span class="line">            <span class="keyword">this</span>.location = <span class="built_in">window</span>.location;</span><br><span class="line">            instance = <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    goBack = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.history.back();</span><br><span class="line">        cb &amp;&amp; cb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    goForward = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.history.forward();</span><br><span class="line">        cb &amp;&amp; cb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    go = <span class="function">(<span class="params">num, cb</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.history.go(num);</span><br><span class="line">        cb &amp;&amp; cb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pushState = <span class="function">(<span class="params">url, state, cb</span>) =&gt;</span> &#123;</span><br><span class="line">        url = url || <span class="string">''</span>;</span><br><span class="line">        <span class="comment">// 加 #，以 hash 的方式改变 url；如果不加，直接以 '/abc' 更改，刷新会报错，请求不到资源（js,css,···）</span></span><br><span class="line">        url = url[<span class="number">0</span>] === <span class="string">'/'</span> ? <span class="string">`#<span class="subst">$&#123;url&#125;</span>`</span> : <span class="string">`/#<span class="subst">$&#123;url&#125;</span>`</span>;</span><br><span class="line">        <span class="keyword">this</span>.history.pushState(state || <span class="literal">null</span>, <span class="string">''</span>, url);</span><br><span class="line">        cb &amp;&amp; cb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    replaceState = <span class="function">(<span class="params">url, state, cb</span>) =&gt;</span> &#123;</span><br><span class="line">        url = url || <span class="string">'/'</span>;</span><br><span class="line">        url = url[<span class="number">0</span>] === <span class="string">'/'</span> ? <span class="string">`#<span class="subst">$&#123;url&#125;</span>`</span> : <span class="string">`/#<span class="subst">$&#123;url&#125;</span>`</span>;</span><br><span class="line">        <span class="keyword">this</span>.history.replaceState(state || <span class="literal">null</span>, <span class="string">''</span>, url);</span><br><span class="line">        cb &amp;&amp; cb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    currentState = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.history.state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    currentUrl = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> url = <span class="keyword">this</span>.location.hash.replace(<span class="string">'#'</span>, <span class="string">''</span>);</span><br><span class="line">        <span class="keyword">if</span> (url[<span class="number">0</span>] === <span class="string">'/'</span>) &#123;</span><br><span class="line">            url = url.replace(<span class="string">'/'</span>, <span class="string">''</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rootUrl = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.location.host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    originUrl = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.location.origin;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fullUrl = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.location.href;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    historyLength = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.history.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拦截器 拦截读写权限</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> handler = &#123;</span><br><span class="line">    <span class="keyword">set</span>(target, key, value) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Setting the <span class="subst">$&#123;key&#125;</span> prototype is forbidden`</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteProperty(target, key) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Deleting the <span class="subst">$&#123;key&#125;</span> prototype is forbidden`</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    defineProperty (target, key, descriptor) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Defining the <span class="subst">$&#123;key&#125;</span> prototype is forbidden`</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    setPrototypeOf (target, proto) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Changing the prototype is forbidden'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routerInstance = <span class="keyword">new</span> <span class="built_in">Proxy</span>(<span class="keyword">new</span> Router(), handler);</span><br></pre></td></tr></table></figure><h2 id="路由装饰函数-withRouter-js"><a href="#路由装饰函数-withRouter-js" class="headerlink" title="路由装饰函数 withRouter.js"></a>路由装饰函数 withRouter.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> withRouter = <span class="function">(<span class="params">config = &#123;&#125;</span>) =&gt;</span> <span class="function">(<span class="params">WrapComponent</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">        <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">            <span class="keyword">super</span>(props);</span><br><span class="line">            <span class="keyword">this</span>.state = &#123;</span><br><span class="line">                data: &#123;&#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        componentDidMount() &#123;</span><br><span class="line">            config.listenPopState === <span class="literal">true</span> &amp;&amp; <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, <span class="keyword">this</span>.handlePopState);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        handlePopState = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;<span class="attr">data</span>: data&#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        componentWillUnmount() &#123;</span><br><span class="line">            config.listenPopState === <span class="literal">true</span> &amp;&amp; <span class="built_in">window</span>.removeEventListener(<span class="string">'popstate'</span>, <span class="keyword">this</span>.handlePopState);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        render() &#123;</span><br><span class="line">            <span class="keyword">const</span> router = &#123;</span><br><span class="line">                go: routerInstance.go,</span><br><span class="line">                goBack: routerInstance.goBack,</span><br><span class="line">                fullUrl: routerInstance.fullUrl,</span><br><span class="line">                rootUrl: routerInstance.rootUrl,</span><br><span class="line">                originUrl: routerInstance.originUrl,</span><br><span class="line">                goForward: routerInstance.goForward,</span><br><span class="line">                pushState: routerInstance.pushState,</span><br><span class="line">                currentUrl: routerInstance.currentUrl,</span><br><span class="line">                replaceState: routerInstance.replaceState,</span><br><span class="line">                currentState: routerInstance.currentState,</span><br><span class="line">                historyLength: routerInstance.historyLength</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> React.createElement(WrapComponent, &#123;</span><br><span class="line">                routerData: <span class="keyword">this</span>.state.data,</span><br><span class="line">                router: <span class="keyword">new</span> <span class="built_in">Proxy</span>(router, handler),<span class="comment">// handler 上面定义的拦截器</span></span><br><span class="line">                ...this.props</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="入口组建-App-js"><a href="#入口组建-App-js" class="headerlink" title="入口组建 App.js"></a>入口组建 App.js</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Layout&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> GYSider <span class="keyword">from</span> <span class="string">'./GYSider'</span>;</span><br><span class="line"><span class="keyword">import</span> GYHeader <span class="keyword">from</span> <span class="string">'./GYHeader'</span>;</span><br><span class="line"><span class="keyword">import</span> GYContent <span class="keyword">from</span> <span class="string">'./GYContent'</span>;</span><br><span class="line"><span class="keyword">import</span> Test_1 <span class="keyword">from</span> <span class="string">'../app/Test_1'</span>;</span><br><span class="line"><span class="keyword">import</span> Test_2 <span class="keyword">from</span> <span class="string">'../app/Test_2'</span>;</span><br><span class="line"><span class="keyword">import</span> Test_3 <span class="keyword">from</span> <span class="string">'../app/Test_3'</span>;</span><br><span class="line"><span class="keyword">import</span> Test_1_1_1 <span class="keyword">from</span> <span class="string">'../app/Test_1_1_1'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">'../util/router'</span>;</span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'../util/Util'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;Header, Sider, Content&#125; = Layout;</span><br><span class="line"></span><br><span class="line">@withRouter()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">const</span> propsState = props.initialState || &#123;&#125;;</span><br><span class="line">        <span class="keyword">const</span> initialState = &#123;</span><br><span class="line">            menuList: [</span><br><span class="line">                &#123;</span><br><span class="line">                    path: <span class="string">'test_1'</span>,</span><br><span class="line">                    icon: <span class="string">'user'</span>,</span><br><span class="line">                    text: <span class="string">'test_1'</span>,</span><br><span class="line">                    component: Test_1,</span><br><span class="line">                    children: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            path: <span class="string">'test_1/test_1_1'</span>,</span><br><span class="line">                            text: <span class="string">'test_1_1'</span>,</span><br><span class="line">                            children: [</span><br><span class="line">                                &#123;</span><br><span class="line">                                    path: <span class="string">'test_1/test_1_1/test_1_1_1'</span>,</span><br><span class="line">                                    component: Test_1_1_1,</span><br><span class="line">                                    text: <span class="string">'test_1_1_1'</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    path: <span class="string">'test_2'</span>,</span><br><span class="line">                    icon: <span class="string">'setting'</span>,</span><br><span class="line">                    text: <span class="string">'test_2'</span>,</span><br><span class="line">                    component: Test_2</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    path: <span class="string">'test_3'</span>,</span><br><span class="line">                    icon: <span class="string">'logout'</span>,</span><br><span class="line">                    text: <span class="string">'test_3'</span>,</span><br><span class="line">                    component: Test_3</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            store: &#123;</span><br><span class="line">                menuList: initialState.menuList.concat(propsState.menuList || [])</span><br><span class="line">            &#125;,</span><br><span class="line">            collapsed: <span class="literal">false</span>,</span><br><span class="line">            currentPath: <span class="string">''</span>,</span><br><span class="line">            currentComponent: GYContent</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">this</span>.getAllComponent(<span class="keyword">this</span>.state.store.menuList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存所有的路由对应的组件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    getAllComponent = <span class="function">(<span class="params">menuList = []</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.allComponent = <span class="keyword">this</span>.allComponent || <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">        menuList.forEach(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (val.path &amp;&amp; Util.isReactComponent(val.component)) &#123;</span><br><span class="line">                <span class="keyword">this</span>.allComponent.set(val.path, val.component);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (Util.isArray(val.children)) &#123;</span><br><span class="line">                <span class="keyword">this</span>.getAllComponent(val.children);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">        store: PropTypes.object,</span><br><span class="line">        onClickAction: PropTypes.func</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> childContextTypes = &#123;</span><br><span class="line">        store: PropTypes.object.isRequired,</span><br><span class="line">        onClickAction: PropTypes.func.isRequired</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 子组件获取 store</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    getChildContext() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            store: <span class="keyword">this</span>.state.store,</span><br><span class="line">            onClickAction: <span class="keyword">this</span>.handleClickAction</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新 store 时需要返回合并之后的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    handleClickAction = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(<span class="built_in">Object</span>.assign(<span class="keyword">this</span>.state, data));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">        <span class="comment">// 刷新浏览器，跳转到相应页面</span></span><br><span class="line">        <span class="keyword">const</span> currentPath = <span class="keyword">this</span>.state.currentPath;</span><br><span class="line">        <span class="keyword">const</span> documentHref = <span class="keyword">this</span>.props.router.currentUrl();</span><br><span class="line">        <span class="keyword">if</span> (currentPath !== documentHref &amp;&amp; <span class="keyword">this</span>.allComponent.has(documentHref)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                currentComponent: <span class="keyword">this</span>.allComponent.get(documentHref)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onToggle = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            collapsed: !<span class="keyword">this</span>.state.collapsed</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onCollapse = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'onCollapse'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> Component = <span class="keyword">this</span>.state.currentComponent;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Layout className=<span class="string">'gy-app-view'</span>&gt;</span><br><span class="line">                &lt;Sider</span><br><span class="line">                    collapsible</span><br><span class="line">                    breakpoint=<span class="string">"md"</span></span><br><span class="line">                    width=&#123;<span class="number">256</span>&#125;</span><br><span class="line">                    collapsed=&#123;<span class="keyword">this</span>.state.collapsed&#125;</span><br><span class="line">                    trigger=&#123;<span class="literal">null</span>&#125;</span><br><span class="line">                    onCollapse=&#123;<span class="keyword">this</span>.onCollapse&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                    &lt;GYSider/&gt;</span><br><span class="line">                &lt;<span class="regexp">/Sider&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Layout&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;Header className='header'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;GYHeader collapsed=&#123;this.state.collapsed&#125; onToggle=&#123;this.onToggle&#125;/</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Header&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;Content className='gy-content'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Component/</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Content&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>Layout&gt;</span><br><span class="line">            &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure><h2 id="侧边栏组件"><a href="#侧边栏组件" class="headerlink" title="侧边栏组件"></a>侧边栏组件</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Menu, Icon&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">const</span> SubMenu = Menu.SubMenu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'../util/Util'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">'../util/router'</span>;</span><br><span class="line"><span class="keyword">import</span> connectStore <span class="keyword">from</span> <span class="string">'../util/connectStore'</span>;</span><br><span class="line"></span><br><span class="line">@withRouter()   <span class="comment">// 接入路由</span></span><br><span class="line">@connectStore   <span class="comment">// 接入 store</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GYSider</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillReceiveProps(nextProps, nextContext) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'点击 subMenu 更新 store'</span>, nextContext.store);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onMenuClick = <span class="function">(<span class="params">&#123;item, key, keyPath&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">const</span> path = item.props.path;</span><br><span class="line">        <span class="keyword">const</span> currentUrl = <span class="keyword">this</span>.props.router.currentUrl() || <span class="string">''</span>;</span><br><span class="line">        path &amp;&amp; path !== currentUrl &amp;&amp; item.props.component</span><br><span class="line">        &amp;&amp; self.props.router.pushState(<span class="string">`/<span class="subst">$&#123;path&#125;</span>`</span>, &#123;<span class="attr">path</span>: <span class="string">`/<span class="subst">$&#123;path&#125;</span>`</span>&#125;, () =&gt; &#123;</span><br><span class="line">            self.context.onClickAction(&#123;</span><br><span class="line">                currentPath: path,</span><br><span class="line">                currentComponent: item.props.component</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新 store 示例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    onSubMenuClick = <span class="function">(<span class="params">&#123;key, domEvent&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> store = <span class="keyword">this</span>.context.store;</span><br><span class="line">        <span class="keyword">this</span>.context.onClickAction(&#123;<span class="attr">store</span>: <span class="built_in">Object</span>.assign(store, &#123;[key]: key&#125;)&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    createMenu = <span class="function">(<span class="params">arr = []</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> arr.map &amp;&amp; arr.map(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!val.text) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> key = val.path || Util.generateKey();</span><br><span class="line">                    <span class="keyword">return</span> Util.isArray(val.children) ?</span><br><span class="line">                        &lt;SubMenu</span><br><span class="line">                            key=&#123;key&#125;</span><br><span class="line">                            onTitleClick=&#123;<span class="keyword">this</span>.onSubMenuClick&#125;</span><br><span class="line">                            title=&#123;&lt;span&gt;&#123;val.icon &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">val.icon</span>&#125;`&#125;/&gt;</span>&#125;</span></span><br><span class="line">                                &lt;span&gt;</span><br><span class="line">                                    &#123;val.text&#125;</span><br><span class="line"><span class="xml">                                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>&#125;&gt;</span><br><span class="line">                            &#123;<span class="keyword">this</span>.createMenu(val.children)&#125;</span><br><span class="line">                        &lt;<span class="regexp">/SubMenu&gt;</span></span><br><span class="line"><span class="regexp">                        :</span></span><br><span class="line"><span class="regexp">                        &lt;Menu.Item path=&#123;val.path&#125; key=&#123;key&#125; component=&#123;val.component&#125;&gt;</span></span><br><span class="line"><span class="regexp">                            &#123;val.icon &amp;&amp; &lt;Icon type=&#123;`$&#123;val.icon&#125;`&#125;/</span>&gt;&#125;</span><br><span class="line">                            &lt;span&gt;</span><br><span class="line">                                &#123;val.text&#125;</span><br><span class="line">                            &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;/</span>Menu.Item&gt;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).filter(<span class="function"><span class="params">val</span> =&gt;</span> val !== <span class="literal">undefined</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div className=<span class="string">'logo'</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">                &lt;Menu</span><br><span class="line">                    theme=<span class="string">"dark"</span></span><br><span class="line">                    mode=<span class="string">"inline"</span></span><br><span class="line">                    onClick=&#123;<span class="keyword">this</span>.onMenuClick&#125;</span><br><span class="line">                    style=&#123;&#123;<span class="attr">margin</span>: <span class="string">'16px 0'</span>, <span class="attr">width</span>: <span class="string">'100%'</span>&#125;&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                    &#123;<span class="keyword">this</span>.createMenu(<span class="keyword">this</span>.context.store.menuList)&#125;</span><br><span class="line">                &lt;<span class="regexp">/Menu&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> GYSider;</span><br></pre></td></tr></table></figure><h2 id="接入-store-装饰函数-connectStore-js"><a href="#接入-store-装饰函数-connectStore-js" class="headerlink" title="接入 store 装饰函数 connectStore.js"></a>接入 store 装饰函数 connectStore.js</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">connectStore</span>(<span class="params">Component</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!Component || <span class="keyword">typeof</span> Component !== <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">`<span class="subst">$&#123;Component &amp;&amp; Component.name&#125;</span> is not a class`</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Component.contextTypes = &#123;</span><br><span class="line">        store: PropTypes.object,</span><br><span class="line">        onClickAction: PropTypes.func</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> 上面的入口组建 App</span><br><span class="line"><span class="keyword">import</span> UMD <span class="keyword">from</span> <span class="string">'./UMD'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WrapView</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">let</span> initialState = &#123;</span><br><span class="line">            menuList: [</span><br><span class="line">                &#123;</span><br><span class="line">                    path: <span class="string">'umd'</span>,        <span class="comment">//对应的地址栏 url</span></span><br><span class="line">                    icon: <span class="string">'setting'</span>,    <span class="comment">//侧边栏的显示图标</span></span><br><span class="line">                    text: <span class="string">'umd'</span>,        <span class="comment">//侧边栏的显示文字</span></span><br><span class="line">                    component: UMD      <span class="comment">//点击时对应的右侧内容区组件</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;App initialState=&#123;initialState&#125;/&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> WrapView;</span><br><span class="line"></span><br><span class="line">···</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;render&#125; <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> WrapView <span class="keyword">from</span> <span class="string">'./app/components/WrapView'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Main App View</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">WrapView</span> /&gt;</span>, document.getElementById('app'));</span></span><br></pre></td></tr></table></figure><p><strong>核心思路</strong>是通过 context 达到类似于 redux 管理数据的目的，App.js 提供 store（存储数据） 和 onClickAction（修改 store）给子组件，子组件通过 connectStore 装饰函数获取到 store 和 onClickAction，点击侧边栏的时候，先取到设置的 path 和 component，然后通过 onCLickAction 设置 currentComponent 和 currentPath，然后 setState 即可实现需求。<br>目前还有一个问题，就是刷新浏览器的时候如何跳转到相应的页面呢？<br>可以在 App.js 里面先获取到所有的 component 和 path 然后保存起来：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 保存所有的路由对应的组件</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">getAllComponent = <span class="function">(<span class="params">menuList = []</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.allComponent = <span class="keyword">this</span>.allComponent || <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">    menuList.forEach(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (val.path &amp;&amp; Util.isReactComponent(val.component)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.allComponent.set(val.path, val.component);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Util.isArray(val.children)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.getAllComponent(val.children);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再在 App.js 通过以下代码跳转：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">componentWillMount() &#123;</span><br><span class="line">    <span class="comment">// 刷新浏览器，跳转到相应页面</span></span><br><span class="line">    <span class="keyword">const</span> currentPath = <span class="keyword">this</span>.state.currentPath;</span><br><span class="line">    <span class="keyword">const</span> documentHref = <span class="keyword">this</span>.props.router.currentUrl();</span><br><span class="line">    <span class="keyword">if</span> (currentPath !== documentHref &amp;&amp; <span class="keyword">this</span>.allComponent.has(documentHref)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            currentComponent: <span class="keyword">this</span>.allComponent.get(documentHref)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot 常用注解</title>
      <link href="/2017/08/12/Spring-Boot-%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3/"/>
      <url>/2017/08/12/Spring-Boot-%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h2 id="常见注解"><a href="#常见注解" class="headerlink" title="常见注解"></a>常见注解</h2><ol><li>@SpringBootApplication 申明让spring boot自动给程序进行必要的配置，<br> 等价于以默认属性使用@Configuration，@EnableAutoConfiguration和@ComponentScan</li><li>@Configuration 相当于把该类作为spring的xml配置文件中的<beans>，作用为：配置spring容器(应用上下文)<br> 凡是被Spring管理的类，实现接口 EnvironmentAware 重写方法 setEnvironment 可以在工程启动时，<br> 获取到系统环境变量和application配置文件中的变量</beans></li><li>@EnableScheduling 在 Spring Boot 的配置类中，标注上这个注解，就可以对项目中的方法某些方法使用@Schedule注解，将其变为定时自动执行。<br> 但只有两种注解共同使用时，才能达到本注解应有的作用。</li><li>@Qualifier 限定描述符除了能根据名字进行注入，但能进行更细粒度的控制如何选择候选者</li><li>@ImportResource 用来加载xml配置文件。</li><li>@Autowired 自动导入依赖的bean</li><li>@RestController 返回json字符串的数据，直接可以编写RESTFul的接口</li><li>@ComponentScan 表示将该类自动发现（扫描）并注册为Bean，可以自动收集所有的Spring组件,<br> 包括@Configuration类。我们经常使用@ComponentScan注解搜索beans，并结合@Autowired注解导入。<br> 如果没有配置的话，Spring Boot会扫描启动类所在包下以及子包下的使用了@Service,@Repository等注解的类。</li><li>@ServletComponentScan spring能够扫描到自己编写的servlet和filter，<br> SpringBootApplication 上使用@ServletComponentScan注解后，Servlet、Filter、Listener，<br> 可以直接通过 @WebServlet、@WebFilter、@WebListener 注解自动注册，无需其他代码</li><li>@Import({DynamicDataSourceRegister.class}) 注册动态多数据源</li><li>@PropertySource(value = “classpath:spring/config.properties”)<br>通过@PropertySource注解将properties配置文件中的值存储到Spring的 Environment中，Environment接口提供方法去读取配置文件中的值，<br>参数是properties文件中定义的key值。上面是读取一个配置文件，如果你想要读取多个配置文件，请看下面代码片段<br>@PropertySource(value = {“classpath:spring/config.properties”,”classpath:spring/news.properties”})</li><li>@EnableWebSocketMessageBroker 表示开启使用STOMP协议来传输基于代理的消息，Broker就是代理的意思。</li><li>@Repository<br>@Repository、@Service、@Controller，它们分别对应存储层 Bean，业务层 Bean，和展示层 Bean，将类标识为 Bean；<br>分别用于软件系统的不同层次：<br>@Component 是一个泛化的概念，仅仅表示一个组件 (Bean) ，可以作用在任何层次。<br>@Service 通常作用在业务层，但是目前该功能与 @Component 相同。<br>@Constroller 通常作用在控制层，但是目前该功能与 @Component 相同。<br>通过在类上使用 @Repository、@Component、@Service 和 @Constroller 注解，Spring会自动创建相应的 BeanDefinition 对象，<br>并注册到 ApplicationContext 中。这些类就成了 Spring 受管组件。这三个注解除了作用于不同软件层次的类，<br>其使用方式与 @Repository 是完全相同的。</li><li>@Value(“${spring.datasource.url}”) 获取 application 配置文件中的变量</li><li>@ConfigurationProperties 读取application属性配置文件中的属性</li><li>@ControllerAdvice 全局异常处理类，以将对于控制器的全局配置放在同一个位置。<ul><li>注解了@Controller的类的方法可以使用@ExceptionHandler、@InitBinder、@ModelAttribute注解到方法上。</li><li>ControllerAdvice注解将作用在所有注解了@RequestMapping的控制器的方法上</li><li>ExceptionHandler：用于全局处理控制器里的异常。</li><li>InitBinder：用来设置WebDataBinder，用于自动绑定前台请求参数到Model中。</li><li>ModelAttribute：本来作用是绑定键值对到Model中，此处让全局的@RequestMapping都能获得在此处设置的键值对。</li></ul></li><li>@WebFilter 将一个实现了javax.servlet.Filter接口的类定义为过滤器<ul><li>属性filterName声明过滤器的名称,可选</li><li>属性urlPatterns指定要过滤的URL模式,也可使用属性value来声明.(指定要过滤的URL模式是必选属性)</li></ul></li><li>@Service <ul><li>声明类是一个 bean，其他的类才可以使用 @Autowired 将其作为一个成员变量自动注入</li><li>Zoo.java 在 bean 中的 id 是 “zoo”，即类名且首字母小写</li></ul></li><li>@Scope(“prototype”) Spring默认产生的bean是单例的，”prototype” 表示原型即每次都会new一个新的出来</li><li>@Bean标注在方法上(返回某个实例的方法)，作用为注册bean对象<ul><li>@Bean注解在返回实例的方法上，如果未通过@Bean指定bean的名称，则默认与标注的方法名相同； </li><li>@Bean注解默认作用域为单例singleton作用域，可通过@Scope(“prototype”)设置为原型作用域； </li><li>既然@Bean的作用是注册bean对象，那么完全可以使用@Component、@Controller、@Service、@Ripository等<br>  注解注册bean，当然需要配置@ComponentScan注解进行自动扫描。<h2 id="RestController-相关"><a href="#RestController-相关" class="headerlink" title="RestController 相关"></a>RestController 相关</h2></li></ul></li><li>@RestController 返回json字符串的数据，直接可以编写RESTFul的接口，@ResponseBody和@Controller的合集</li><li>@PathVariable 当使用@RequestMapping URI template 样式映射时，即 someUrl/{paramId},<br> 这时的paramId可通过 @Pathvariable注解绑定它传过来的值到方法的参数上</li><li>@RequestHeader 可以把Request请求header部分的值绑定到方法的参数上如<code>(@RequestHeader(&quot;Accept-Encoding&quot;) String encoding){}</code>。</li><li>@CookieValue 可以把Request header中关于cookie的值绑定到方法的参数上如<code>(@CookieValue(&quot;JSESSIONID&quot;) String cookie){}</code>。</li><li>@RequestParam<ul><li>常用来处理简单类型的绑定，通过 Request.getParameter() 获取的String可直接转换为简单类型的情况<br>（ String–&gt; 简单类型的转换操作由ConversionService配置的转换器来完成）；<br>因为使用request.getParameter()方式获取参数，所 以可以处理get 方式中queryString的值，也可以处理post方式中 body data的值；</li><li>用来处理Content-Type: 为 application/x-www-form-urlencoded编码的内容，提交方式GET、POST；</li><li>该注解有两个属性： value、required； value用来指定要传入值的id名称，required用来指示参数是否必须绑定；</li></ul></li><li>@RequestBody 通过使用HandlerAdapter默认配置的HttpMessageConverters来解析Request请求的Body部分数据并将相应的数据绑定到Controller中方法的参数上，其常用来处理Content-Type不是application/x-www-form-urlencoded编码的内容，例如application/json, application/xml等。<ul><li>它是通过使用HandlerAdapter 配置的HttpMessageConverters来解析post data body，然后绑定到相应的bean上的。</li><li>因为配置有FormHttpMessageConverter，所以也可以用来处理 application/x-www-form-urlencoded的内容，处理完的结果放在一个<code>MultiValueMap&lt;String, String&gt;</code>里，这种情况在某些特殊需求下使用。</li></ul></li><li>@SessionAttributes 用来绑定HttpSession中的attribute对象的值，便于在方法中的参数里使用。<br> 该注解有value、types两个属性，可以通过名字和类型指定要使用的attribute 对象</li><li>@ModelAttribute  该注解有两个用法，一个是用于方法上，一个是用于参数上：<ul><li>用于方法上时：  通常用来在处理@RequestMapping之前，为请求绑定需要从后台查询的model；</li><li>用于参数上时： 用来通过名称对应，把相应名称的值绑定到注解的参数bean上；要绑定的值来源于：<ul><li>@SessionAttributes 启用的attribute 对象上；</li><li>@ModelAttribute 用于方法上时指定的model对象；</li><li>上述两种情况都没有时，new一个需要绑定的bean对象，然后把request中按名称对应的方式把值绑定到bean中，<br>  这种方式实际的效果就是在调用@RequestMapping的方法之前，为request对象的model里put（“account”， Account）</li></ul></li></ul></li><li>@Controller 用于定义控制器类，控制器负责将用户发来的URL请求转发到对应的服务接口（service层），<br> 一般这个注解在类中，通常方法需要配合注解@RequestMapping<h2 id="JPA-相关"><a href="#JPA-相关" class="headerlink" title="JPA 相关"></a>JPA 相关</h2></li><li>@Entity 注释声明该类为持久类,最好实现序列化，此时,默认情况下,所有的类属性都为映射到数据表的持久性字段</li><li>@Table(name=””,catalog=””,schema=””) 持久性映射的表,通常和@Entity 配合使用，只能标注在实体的 class 定义处，<br> 表示实体对应的数据库表的信息。<ul><li>name - 可选，表示表的名称，默认地，表名和实体名称一致，只有在不一致的情况下才需要指定表名</li><li>catalog - 可选，表示Catalog名称，默认为 Catalog(“”).</li><li>schema - 可选 , 表示 Schema 名称 , 默认为Schema(“”).</li></ul></li><li>@Id 注释可以表明哪种属性是该类中的独特标识符(即相当于数据表的主键)。</li><li>@GeneratedValue 定义自动增长的主键的生成策略.</li><li>@Transient 将忽略这些字段和属性,不用持久化到数据库.</li><li>@Temporal(TemporalType.TIMESTAMP) 声明时间格式 </li><li>@Enumerated 声明枚举 </li><li>@Version 声明添加对乐观锁定的支持 </li><li>@OneToOne 可以建立实体bean之间的一对一的关联 </li><li>@OneToMany 可以建立实体bean之间的一对多的关联 </li><li>@ManyToOne 可以建立实体bean之间的多对一的关联 </li><li>@ManyToMany 可以建立实体bean之间的多对多的关联 </li><li>@Formula 一个SQL表达式，这种属性是只读的,不在数据库生成属性(可以使用sum、average、max等) </li><li>@OrderBy Many端某个字段排序(List)</li><li>@Column注解设置，包含的设置如下 <ul><li>name：字段名 </li><li>unique：是否唯一 </li><li>nullable：是否可以为空 </li><li>inserttable：是否可以插入 </li><li>updateable：是否可以更新 </li><li>columnDefinition: 定义建表时创建此列的DDL </li><li>secondaryTable: 从表名。如果此列不建在主表上（默认建在主表），该属性定义该列所在从表的名字。</li></ul></li><li>@JoinColumn(name = “”, referencedColumnName = “”) 设置对应数据表的列名和引用的数据表的列名</li><li>@Lob 注解属性将被持久化为 Blog 或 Clob 类型,根据get方法的返回值不同,自动进行Clob和Blob的转换。<br>因为这两种类型的数据一般占用的内存空间比较大，所以通常使用延迟加载的方式，与@Basic标记同时使用，设置加载方式为FetchType.LAZY。<ul><li>Clob（Character Large Ojects）类型是长字符串类型，具体的java.sql.Clob, Character[], char[] 和 java.lang.String 将被持久化为 Clob 类型。</li><li>Blob（Binary Large Objects）类型是字节类型，具体的java.sql.Blob, Byte[], byte[] 和 serializable type 将被持久化为 Blob 类型。</li></ul></li><li>@Basic<br> 实体Bean中所有的非Static 非transient的属性都可以被持久化，没有定义注解属性的等价于在其上添加了@Basic注解。<br> 通过@Basic注解可以声明属性的获取策略(lazy与否)，默认的是即时获取(early fetch)。<br> 通常不需要对简单属性设置延迟获取，如需要定义@Basic(fetch=FetchType.LAZY)<br> 在MySQL中没有Clob，用Text代替了，而且分为了tinytext， text，mediumtext，longtext。Blob也按这种方式分成了四种。</li><li>@Transactional注解<ul><li>rollbackFor 表示当该方法中抛出指定的异常时数据回滚</li><li>dontRollbackOn 表示当该方法中抛出指定的异常时数据不回滚</li></ul></li></ol><h2 id="hibernate-validator"><a href="#hibernate-validator" class="headerlink" title="hibernate-validator"></a>hibernate-validator</h2><ol><li>@size (min=3, max=20, message=”用户名长度只能在3-20之间”)</li><li>@size (min=6, max=20, message=”密码长度只能在6-20之间”)</li><li>@pattern (regexp=”[a-za-z0-9._%+-]+@[a-za-z0-9.-]+\.[a-za-z]{2,4}”, message=”邮件格式错误”)</li><li>@Length(min = 5, max = 20, message = “用户名长度必须位于5到20之间”)</li><li>@Email(message = “比如输入正确的邮箱”)</li><li>@NotNull(message = “用户名称不能为空”)</li><li>@Max(value = 100, message = “年龄不能大于100岁”)</li><li>@Min(value= 18 ,message= “必须年满18岁！” )</li><li>@AssertTrue(message = “bln4 must is true”)</li><li>@AssertFalse(message = “blnf must is falase”)</li><li>@DecimalMax(value=”100”,message=”decim最大值是100”)</li><li>@DecimalMin(value=”100”,message=”decim最小值是100”)</li><li>@NotNull(message = “身份证不能为空”)</li><li>@Pattern(regexp=”^(\d{18,18}|\d{15,15}|(\d{17,17}[x|X]))$”, message=”身份证格式错误”)<h2 id="Service-VS-Bean-和-Configuration"><a href="#Service-VS-Bean-和-Configuration" class="headerlink" title="@Service VS @Bean 和 @Configuration"></a>@Service VS @Bean 和 @Configuration</h2>@Service实际上表示了DDD中的无状态的，独立的，以接口的形式提供的一个操作。采用@Bean和@Configuration配合的方式，Bean的创建交给了单独的类，而Service的标识给了Java中的Interface以及类的名字。这点在Spring Data也有所体现，比如Repository就是通过名字来标识，如CrudRepository。因此Service也通过名字来体现。具体层次定义，通过名字而不依赖Spring提供的注解，便于根据项目提供更多的层次，比如Mapper层，Validator层等。另外，本身Bean和Service就是两个维度的概念。一个关于具体实现，另一个关于DDD中的概念。使用@Bean的方式，能够创建库里面的类的实例。如果使用@Service的方式，没办法在库里面对应的类上添加@Service注解。<h2 id="Resource、-Autowired、-Qualifier-区别"><a href="#Resource、-Autowired、-Qualifier-区别" class="headerlink" title="@Resource、@Autowired、@Qualifier 区别"></a>@Resource、@Autowired、@Qualifier 区别</h2>@Resource和@Autowired都可以来完成注入依赖，但它们之间是有区 别的：</li><li>@Resource默认是按照名称来装配注入的，只有当找不到与名称匹配的bean才会按照类型来装配注入；</li><li>@Autowired默认是按照类型装配注入的，如果想按照名称来转配注入，则需要结合@Qualifier一起使用；</li><li>@Resource注解是又J2EE提供，而@Autowired是由Spring提供，故减少系统对spring的依赖建议使用@Resource的方式；</li><li>@Resource和@Autowired都可以书写标注在字段或者该字段的setter方法之上</li></ol>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>fatal: Could not read from remote repository.的解决办法</title>
      <link href="/2017/07/28/fatal-Could-not-read-from-remote-repository-%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
      <url>/2017/07/28/fatal-Could-not-read-from-remote-repository-%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>查看远端地址 <code>git remote –v</code><br>查看配置 <code>git config --list</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git add .  // 暂存所有的更改</span><br><span class="line">git checkout . // 丢弃所有的更改</span><br><span class="line">git status // 查看文件状态</span><br><span class="line">git commit -m &quot;本次要提交的概要信息&quot; // 提交</span><br></pre></td></tr></table></figure><p>设置远端仓库地址 <code>git remote set-url origin 你的远端地址</code></p><p>git remote add origin_new 新的地址</p><p>git remote –v查看</p><p>git push origin_new master重新推送</p><p>下面是设置用户名</p><p>Git config –global user.name “用户名”</p><p>git config –global user.email 邮箱地址</p><p>设置代理： <code>git config --global https.proxy http://127.0.0.1:1080</code></p><p>取消设置代理：<code>git config --global --unset https.proxy</code></p><p>取消git init操作时出现    <strong>rm: cannot remove ‘.git’: Is a directory</strong><br>是因为输入的命令是：    <strong>rm -f .git</strong><br>解决办法：<strong>rm -rf .git</strong> 即删除整个.git目录</p><p>failed to push some refs to ‘git@github.com:***.git’ hint: Updates were rejected ···<br>使用git push origin master的时候出现一下错误：</p><p>解决办法：<br>git push -f origin master或者git pull下</p><p>恢复不小心删除的 <strong>git stash</strong> 文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git fsck  //找到dangling的对象</span><br><span class="line">git show id  //上面列出的每一条记录的最后一个字符串，按 enter 查看具体信息</span><br><span class="line">git stash apply id</span><br></pre></td></tr></table></figure><p><strong>git 回滚提交</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//reset将一个分支的末端指向另一个提交。这可以用来移除当前分支的一些提交, 让master分支向后回退了两个提交</span><br><span class="line">git checkout master</span><br><span class="line">git reset HEAD~2</span><br><span class="line"></span><br><span class="line">//Revert撤销一个提交的同时会创建一个新的提交, 找出倒数第二个提交，然后创建一个新的提交来撤销这些更改，然后把这个提交加入项目中。</span><br><span class="line">git revert HEAD~2</span><br></pre></td></tr></table></figure><p>错误：<strong>Please enter a commit message to explain why this merge is necessary.</strong> 解决办法：</p><ol><li>（可选）按键盘字母 i 进入insert模式</li><li>（可选）修改最上面那行黄色合并信息</li><li>按键盘左上角”Esc” （退出insert模式）</li><li>输入”:wq”,按回车键即可（提交）</li></ol><p><strong>gitignore notworking</strong>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rm -r --cached .</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;fixed untracked files&quot;</span><br></pre></td></tr></table></figure><p><strong>git Failed to connect to <a href="http://www.google.com" target="_blank" rel="noopener">www.google.com</a> port 80: Timed out</strong> 可能是因为设置了代理：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy//查看代理</span><br><span class="line">git config --global --unset http.proxy//取消代理</span><br></pre></td></tr></table></figure><p><strong>HTTP Basic access denied on Git</strong>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global --unset credential.helper</span><br><span class="line">git clone &apos;···&apos;</span><br><span class="line">login username，password</span><br></pre></td></tr></table></figure><p><strong>rebase 和 merge 区别</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull --rebase origin master</span><br></pre></td></tr></table></figure><p> rebase 选项告诉 Git 把你的提交移到同步了中央仓库修改后的 master 分支的顶部。rebase 操作过程是把本地提交一次一个地迁移到更新了的中央仓库master分支之上。这意味着可能要解决在迁移某个提交时出现的合并冲突，而不是解决包含了所有提交的大型合并时所出现的冲突。这样的方式让你尽可能保持每个提交的聚焦和项目历史的整洁。反过来，简化了哪里引入Bug的分析，如果有必要，回滚修改也可以做到对项目影响最小。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master</span><br></pre></td></tr></table></figure><p>如果没有 rebase， pull 操作仍然可以完成，但每次 pull 操作要同步中央仓库中别人修改时，提交历史会以一个多余的『合并提交』结尾。<br>合并玩冲突之后，<code>git rebase --continue</code>，Git 会继续一个一个地合并后面的提交，如其它的提交有冲突就重复这个过程。<br>如果你碰到了冲突，但发现搞不定，不要惊慌。只要执行下面这条命令，就可以回到你执行git pull –rebase命令前的样子：<code>git rebase --abort</code></p>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>搭建一个包含 redux、router、国际化的前端项目框架</title>
      <link href="/2017/06/08/%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%AB-redux%E3%80%81router%E3%80%81%E5%9B%BD%E9%99%85%E5%8C%96%E7%9A%84%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%A1%86%E6%9E%B6/"/>
      <url>/2017/06/08/%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%AB-redux%E3%80%81router%E3%80%81%E5%9B%BD%E9%99%85%E5%8C%96%E7%9A%84%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>搭建一个交互比较多的 <strong>react 前端项目框架</strong>，数据可预测，可路由跳转，可国际化，数据操作可控制</p><h2 id="使用的主要类库"><a href="#使用的主要类库" class="headerlink" title="使用的主要类库"></a>使用的主要类库</h2><ul><li>i18next 国际化</li><li>react-i18next</li><li>i18next-browser-languagedetector</li><li>immutability-helper</li><li>immutable 处理数据</li><li>react</li><li>react-dom</li><li>react-redux 管理数据</li><li>react-router 路由</li><li>react-router-redux 路由接入 store</li><li>redux<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2></li></ul><ul><li>因为 router 是异步过程，所以注入到 store 中，通过 action 跳转路由</li><li>在 react-redux 原生 action、reducer 之上封装了一层，便于分发、匹配 action、reducer</li><li>执行顺序： action -&gt; 前置拦截器（return true）-&gt; reducer（修改 store）-&gt; componentWillReceiveProps -&gt; shouldComponentUpdate（return true）-&gt; render -&gt; 后置拦截器</li></ul><p><strong>项目地址</strong>：<a href="https://github.com/liangxinwei/redux-ele" target="_blank" rel="noopener">https://github.com/liangxinwei/redux-ele</a></p><h2 id="项目布局"><a href="#项目布局" class="headerlink" title="项目布局"></a>项目布局</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">├── cfg                                 webpack 配置文件</span><br><span class="line">│   ├── base.js                        webpack 配置</span><br><span class="line">│   ├── default.js                     loader，plugin</span><br><span class="line">│   ├── dev.js                         dev 环境 </span><br><span class="line">│   └── dist.js                        dist 环境</span><br><span class="line">├── src                                 源码目录</span><br><span class="line">│   ├── app</span><br><span class="line">│   │   ├── component                  具体业务组件，配合 routes 目录使用</span><br><span class="line">│   │   ├── config                     store 配置</span><br><span class="line">│   │   │   ├── AppActionRouter.js    分发相应 type 的 action</span><br><span class="line">│   │   │   ├── AppReducerCreator.js  匹配相应 type 的 action 的 reducer</span><br><span class="line">│   │   │   ├── ConfigureStore.js       生成 store</span><br><span class="line">│   │   │   └── index.js                统一导出</span><br><span class="line">│   │   ├── i18n                        国际化配置</span><br><span class="line">│   │   │   ├── locales                中英文配置文件</span><br><span class="line">│   │   │   │   ├── en                 英文配置</span><br><span class="line">│   │   │   │   └── zh                 中文配置</span><br><span class="line">│   │   │   ├── i18n.js                 i18next 配置</span><br><span class="line">│   │   │   └── index.js                统一导出</span><br><span class="line">│   │   ├── middleware                   中间件</span><br><span class="line">│   │   │   ├── AppMiddleWare.js        前置、后置拦截器业务代码</span><br><span class="line">│   │   │   ├── ComponentMiddleWare.js  操作拦截器中间件</span><br><span class="line">│   │   │   ├── index.js                中间件统一导出</span><br><span class="line">│   │   │   └── LoggerMiddleWare.js     日志中间件</span><br><span class="line">│   │   ├── routes                       路由配置</span><br><span class="line">│   │   │   └── index.jsx</span><br><span class="line">│   │   └── App.jsx                      app 入口</span><br><span class="line">│   ├── index.ejs                         ejs 模板文件</span><br><span class="line">│   └── index.jsx                         挂载 react dom</span><br><span class="line">├── test</span><br><span class="line">├── .babelrc                            babel 配置文件</span><br><span class="line">├── .editorconfig                       跨平台编辑器配置文件</span><br><span class="line">├── .eslintignore                       eslintignore 配置文件</span><br><span class="line">├── .eslintrc                           eslint 配置文件</span><br><span class="line">├── .gitignore</span><br><span class="line">├── package.json   </span><br><span class="line">├── postcss.config.js                   postcss 配置文件 </span><br><span class="line">├── server.js                           本地服务（webpack-dev-server）</span><br><span class="line">├── webpack.config.js                   webpack 配置文件入口</span><br><span class="line">└── README.md</span><br></pre></td></tr></table></figure><h2 id="App-jsx-项目入口"><a href="#App-jsx-项目入口" class="headerlink" title="App.jsx 项目入口"></a>App.jsx 项目入口</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123;Component&#125; from &apos;react&apos;;</span><br><span class="line">import &#123;Provider&#125; from &apos;react-redux&apos;;</span><br><span class="line">import &#123;I18nextProvider&#125; from &apos;react-i18next&apos;;</span><br><span class="line">import &#123;syncHistoryWithStore&#125; from &apos;react-router-redux&apos;;</span><br><span class="line">import &#123;hashHistory&#125; from &apos;react-router&apos;;</span><br><span class="line"></span><br><span class="line">import &#123;reducers&#125; from &apos;./components&apos;; //合并之后的 reducer</span><br><span class="line">import &#123;default as Store&#125; from &apos;./config/ConfigureStore&apos;;</span><br><span class="line">import appMiddleWares from &apos;./middleware/AppMiddleWare&apos;;</span><br><span class="line"></span><br><span class="line">import &#123;i18n, locales&#125; from &apos;./i18n&apos;; //见下面 i18n 配置</span><br><span class="line">import routes from &apos;./routes&apos;;</span><br><span class="line">import &apos;./style/index.scss&apos;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * App View</span><br><span class="line"> */</span><br><span class="line">class App extends Component &#123;</span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">        // 添加i18n语言包</span><br><span class="line">        for (let ns in locales[&apos;zh&apos;]) &#123;</span><br><span class="line">            if (locales[&apos;zh&apos;].hasOwnProperty(ns)) &#123;</span><br><span class="line">                i18n.addResourceBundle(&apos;zh&apos;, ns, locales[&apos;zh&apos;][ns]);</span><br><span class="line">                i18n.addResourceBundle(&apos;en&apos;, ns, locales[&apos;en&apos;][ns]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        let storeOptions = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        const defaultStates = &#123;&#125;;</span><br><span class="line">        const allReducers = Object.assign(&#123;&#125;, reducers);  //此处可以并入其它模块中的 reducer</span><br><span class="line">        const preMiddleWares = Object.assign(&#123;&#125;, appMiddleWares.preMiddleWares);  //此处可以并入其它模块中的 preMiddleWares</span><br><span class="line">        const postMiddleWares = Object.assign(&#123;&#125;, appMiddleWares.postMiddleWares);  //此处可以并入其它模块中的 postMiddleWares</span><br><span class="line"></span><br><span class="line">        storeOptions.initialStates = defaultStates;</span><br><span class="line">        storeOptions.reducers = allReducers;</span><br><span class="line">        storeOptions.preMiddleWares = preMiddleWares;</span><br><span class="line">        storeOptions.postMiddleWares = postMiddleWares;</span><br><span class="line"></span><br><span class="line">        const store = Store.configureStore(storeOptions);</span><br><span class="line">        const history = syncHistoryWithStore(hashHistory, store);</span><br><span class="line"></span><br><span class="line">        return (</span><br><span class="line">            &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">                &lt;I18nextProvider i18n=&#123;i18n&#125;&gt;</span><br><span class="line">                    &#123;routes(history)&#125;</span><br><span class="line">                &lt;/I18nextProvider&gt;</span><br><span class="line">            &lt;/Provider&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><h2 id="routes-路由配置"><a href="#routes-路由配置" class="headerlink" title="routes 路由配置"></a>routes 路由配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123;Router, Route&#125; from &apos;react-router&apos;;</span><br><span class="line"></span><br><span class="line">import &#123;</span><br><span class="line">    HomeView,</span><br><span class="line">    BusinessDetail</span><br><span class="line">&#125; from &apos;../components&apos;;</span><br><span class="line"></span><br><span class="line">const routes = (history) =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;Router history=&#123;history&#125;&gt;</span><br><span class="line">            &lt;Route path=&quot;/&quot; component=&#123;HomeView&#125;/&gt;</span><br><span class="line">            &lt;Route path=&quot;/home&quot; component=&#123;HomeView&#125;/&gt;</span><br><span class="line">            &lt;Route path=&quot;/business/:id&quot; component=&#123;BusinessDetail&#125;/&gt;</span><br><span class="line">        &lt;/Router&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default routes;</span><br></pre></td></tr></table></figure><h2 id="ConfigureStore-js-构建-Store"><a href="#ConfigureStore-js-构建-Store" class="headerlink" title="ConfigureStore.js 构建 Store"></a>ConfigureStore.js 构建 Store</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import &#123;applyMiddleware, compose, createStore, combineReducers&#125; from &apos;redux&apos;;</span><br><span class="line">import thunk from &apos;redux-thunk&apos;;</span><br><span class="line">import &#123;hashHistory&#125; from &apos;react-router&apos;;</span><br><span class="line">import &#123;routerReducer, routerMiddleware&#125; from &apos;react-router-redux&apos;;</span><br><span class="line"></span><br><span class="line">import &#123;componentMiddleWare, logger&#125; from &apos;../middleware&apos;;</span><br><span class="line">import appReducerCreator from &apos;./AppReducerCreator&apos;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * store 构建器</span><br><span class="line"> */</span><br><span class="line">export function configureStore(config) &#123;</span><br><span class="line">    // 合并之后的 preMiddleWares, postMiddleWares, reducers</span><br><span class="line">    let &#123;initialStates, preMiddleWares, postMiddleWares, reducers&#125; = config;</span><br><span class="line">    let allReducer = Object.assign(&#123;&#125;, reducers);</span><br><span class="line">    let appReducer = appReducerCreator(initialStates, allReducer);</span><br><span class="line">    const finalReducer = combineReducers(&#123;appReducer, routing: routerReducer&#125;);</span><br><span class="line">    const allMiddleWares = [</span><br><span class="line">        thunk,  // 异步 action</span><br><span class="line">        componentMiddleWare(preMiddleWares, postMiddleWares),    // 具体业务拦截器</span><br><span class="line">        routerMiddleware(hashHistory),   // router 注入到 store 中</span><br><span class="line">        logger</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    let enhancer = compose(</span><br><span class="line">        applyMiddleware(...allMiddleWares)</span><br><span class="line">    );</span><br><span class="line">    return createStore(finalReducer, &#123;&#125;, enhancer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Store = &#123;</span><br><span class="line">    configureStore</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default Store;</span><br></pre></td></tr></table></figure><h2 id="AppReducerCreator-js"><a href="#AppReducerCreator-js" class="headerlink" title="AppReducerCreator.js"></a>AppReducerCreator.js</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 全局 Reducer 产生器</span><br><span class="line"> */</span><br><span class="line">function appReducerCreator(wrapInitialState, allReducerMap) &#123;</span><br><span class="line">    function appReducer(state = wrapInitialState, action) &#123;</span><br><span class="line">        if (action &amp;&amp; action.type &amp;&amp; allReducerMap[action.type]) &#123;</span><br><span class="line">            return allReducerMap[action.type](state, action);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return state;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return appReducer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default appReducerCreator;</span><br></pre></td></tr></table></figure><h2 id="ComponentMiddleWare-js-action-拦截器"><a href="#ComponentMiddleWare-js-action-拦截器" class="headerlink" title="ComponentMiddleWare.js action 拦截器"></a>ComponentMiddleWare.js action 拦截器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 操作拦截器中间件</span><br><span class="line"> */</span><br><span class="line">export function componentMiddleWare(preMiddleWares, postMiddleWares) &#123;</span><br><span class="line">    return function (&#123;getState&#125;) &#123;</span><br><span class="line">        return next =&gt; (action) =&gt; &#123;</span><br><span class="line">            // 前置拦截校验函数</span><br><span class="line">            let preInterceptFunc = preMiddleWares ? preMiddleWares[action.type] : null;</span><br><span class="line">            // 进行拦截校验操作</span><br><span class="line">            if (preInterceptFunc &amp;&amp; !preInterceptFunc.call(this, action, getState())) &#123;</span><br><span class="line">                console.error(&apos;Invalid action for preMiddleWares intercept!!&apos;);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // 调用 middleware 链中下一个 middleware 的 dispatch。</span><br><span class="line">            const returnValue = next(action);</span><br><span class="line"></span><br><span class="line">            // 后置拦截函数</span><br><span class="line">            let postInterceptFunc = postMiddleWares ? postMiddleWares[action.type] : null;</span><br><span class="line">            // 进行拦截校验操作</span><br><span class="line">            postInterceptFunc &amp;&amp; postInterceptFunc.call(this, action, getState());</span><br><span class="line">            </span><br><span class="line">            return returnValue;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LoggerMiddleWare-js"><a href="#LoggerMiddleWare-js" class="headerlink" title="LoggerMiddleWare.js"></a>LoggerMiddleWare.js</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 日志 MiddleWare</span><br><span class="line"> */</span><br><span class="line">export function logger(&#123;getState&#125;) &#123;</span><br><span class="line">    return next =&gt; (action) =&gt; &#123;</span><br><span class="line">        console.info(&apos;will dispatch&apos;, action);</span><br><span class="line">        // 调用 middleware 链中下一个 middleware 的 dispatch。</span><br><span class="line">        const returnValue = next(action);</span><br><span class="line">        console.info(&apos;after dispatch&apos;, getState());</span><br><span class="line">        return returnValue;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="AppMiddleWare-js-具体业务中间件，构建-store-时注入"><a href="#AppMiddleWare-js-具体业务中间件，构建-store-时注入" class="headerlink" title="AppMiddleWare.js 具体业务中间件，构建 store 时注入"></a>AppMiddleWare.js 具体业务中间件，构建 store 时注入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 前置拦截器</span><br><span class="line"> */</span><br><span class="line">let preMiddleWares = &#123;</span><br><span class="line">    TEST: (action, state) =&gt; &#123;</span><br><span class="line">        return true;// false 则本次 action 无效，数据不会被修改</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 后置拦截器</span><br><span class="line"> */</span><br><span class="line">let postMiddleWares = &#123;</span><br><span class="line">    TEST: (action, state) =&gt; &#123;</span><br><span class="line">        ··· // 此处修改之后不会立即在 ui 上体现出来，因为它在 render 之后执行。且因为参数 state 为引用，所以是直接修改，可做一些提示性的操作</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let appMiddleWares = &#123;</span><br><span class="line">    preMiddleWares,</span><br><span class="line">    postMiddleWares</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default appMiddleWares;</span><br></pre></td></tr></table></figure><h2 id="connectToStore-js-组件接入-store-decorator"><a href="#connectToStore-js-组件接入-store-decorator" class="headerlink" title="connectToStore.js 组件接入 store decorator"></a>connectToStore.js 组件接入 store decorator</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import &#123;bindActionCreators&#125; from &apos;redux&apos;;</span><br><span class="line">import &#123;connect&#125; from &apos;react-redux&apos;;</span><br><span class="line">import appConfig from &apos;../config&apos;;</span><br><span class="line">// appConfig.router 即下面的 AppActionRouter.js</span><br><span class="line">const AppActionRouter = appConfig.router;</span><br><span class="line"></span><br><span class="line">function mapStateToProps(state) &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        store: state.appReducer || &#123;&#125;,</span><br><span class="line">        routerStore: (state.routing &amp;&amp; state.routing.locationBeforeTransitions) || &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mapDispatchToProps(dispatch) &#123;</span><br><span class="line">    return bindActionCreators(AppActionRouter, dispatch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default function connectToStore(component) &#123;</span><br><span class="line">    return connect(mapStateToProps, mapDispatchToProps)(component);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="AppActionRouter-js-分发-action"><a href="#AppActionRouter-js-分发-action" class="headerlink" title="AppActionRouter.js 分发 action"></a>AppActionRouter.js 分发 action</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import &#123;actions&#125; from &apos;../components&apos;;</span><br><span class="line">// action 为合并之后的所有的 action</span><br><span class="line">/**</span><br><span class="line"> * app action Router</span><br><span class="line"> */</span><br><span class="line">function onClickWithoutCheck(action) &#123;</span><br><span class="line">    return action;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 如果外部注入 action，那么直接使用 action 的操作即可。</span><br><span class="line"> * 如果外部没有注入 action， 使用 dispatch 操作。</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">export function onClickAction(action, props) &#123;</span><br><span class="line">    return function (dispatch, getState) &#123;</span><br><span class="line">        if (action.type &amp;&amp; actions.hasOwnProperty(action.type)) &#123;</span><br><span class="line">            actions[action.type].call(this, action, dispatch, props);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            dispatch(onClickWithoutCheck(action));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="acion-示例"><a href="#acion-示例" class="headerlink" title="acion 示例"></a>acion 示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let homeActions = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">homeActions[&apos;TEST&apos;] = function (action, dispatch, state) &#123;</span><br><span class="line">    dispatch(action);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default homeActions;</span><br></pre></td></tr></table></figure><h2 id="reducer-示例"><a href="#reducer-示例" class="headerlink" title="reducer 示例"></a>reducer 示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import Immutable from &apos;immutable&apos;;</span><br><span class="line"></span><br><span class="line">let homeReducers = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">homeReducers[&apos;TEST&apos;] = function (state, action) &#123;</span><br><span class="line">    let foo = Immutable.fromJS(state);</span><br><span class="line">    let newArr = foo.mergeDeep(Immutable.fromJS(action.content));</span><br><span class="line">    return newArr.toJS();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default homeReducers;</span><br></pre></td></tr></table></figure><h2 id="i18n-配置"><a href="#i18n-配置" class="headerlink" title="i18n 配置"></a>i18n 配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import i18next from &apos;i18next&apos;;</span><br><span class="line">import LanguageDetector from &apos;i18next-browser-languagedetector&apos;;</span><br><span class="line"></span><br><span class="line">const i18n = i18next</span><br><span class="line">    .use(LanguageDetector)</span><br><span class="line">    .init(&#123;</span><br><span class="line">        fallbackLng: &apos;zh&apos;,</span><br><span class="line"></span><br><span class="line">        // have a common namespace used around the full app</span><br><span class="line">        ns: [&apos;common&apos;],</span><br><span class="line">        defaultNS: &apos;common&apos;,</span><br><span class="line"></span><br><span class="line">        debug: false,</span><br><span class="line"></span><br><span class="line">        interpolation: &#123;</span><br><span class="line">            escapeValue: false // not needed for react!!</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, (err) =&gt; &#123;</span><br><span class="line">        if (err) &#123;</span><br><span class="line">            console.error(&apos;i18next&apos;, err);</span><br><span class="line">        &#125;</span><br><span class="line">        // console.log(&apos;i18next initialized and ready to go!&apos;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">export default i18n;</span><br></pre></td></tr></table></figure><h3 id="i18n-英文配置"><a href="#i18n-英文配置" class="headerlink" title="i18n 英文配置"></a>i18n 英文配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const home = &#123;</span><br><span class="line">    title: &apos;Home Page&apos;</span><br><span class="line">&#125;;</span><br><span class="line">export default &#123;home&#125;;</span><br></pre></td></tr></table></figure><h3 id="i18n-中文配置"><a href="#i18n-中文配置" class="headerlink" title="i18n 中文配置"></a>i18n 中文配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const home = &#123;</span><br><span class="line">    title: &apos;首页&apos;</span><br><span class="line">&#125;;</span><br><span class="line">export default &#123;home&#125;;</span><br></pre></td></tr></table></figure><h3 id="i18n-中英文统一导出"><a href="#i18n-中英文统一导出" class="headerlink" title="i18n 中英文统一导出"></a>i18n 中英文统一导出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import zh from &apos;./zh&apos;;</span><br><span class="line">import en from &apos;./en&apos;;</span><br><span class="line"></span><br><span class="line">const locales = &#123;</span><br><span class="line">    zh: zh,</span><br><span class="line">    en: en</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default locales;</span><br></pre></td></tr></table></figure><h2 id="组件实例"><a href="#组件实例" class="headerlink" title="组件实例"></a>组件实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123;Component&#125; from &apos;react&apos;;</span><br><span class="line">import &#123;translate&#125; from &apos;react-i18next&apos;;</span><br><span class="line">import i18n from &apos;../i18n&apos;;</span><br><span class="line"></span><br><span class="line">@translate([&apos;home&apos;], &#123;wait: true&#125;)  // 使用多语言</span><br><span class="line">@connectToStore                     // 组件介入 store</span><br><span class="line">class Test extends Component &#123;</span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 路由跳转</span><br><span class="line">    transformRouter = () =&gt; &#123;</span><br><span class="line">        const &#123;onClickAction&#125; = this.props;</span><br><span class="line">        // 见下面路由 acion</span><br><span class="line">        let gotoAction = &#123;</span><br><span class="line">            type: &apos;GOTO&apos;,</span><br><span class="line">            content: &apos;/home&apos;</span><br><span class="line">        &#125;;</span><br><span class="line">        onClickAction(gotoAction, this.props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 发送 action</span><br><span class="line">    changeStore = () =&gt; &#123;</span><br><span class="line">        const &#123;onClickAction, store&#125; = this.props;</span><br><span class="line">        let action = &#123;</span><br><span class="line">            type: &apos;TEST&apos;,</span><br><span class="line">            content: &#123;data: &apos;test&apos;&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        onClickAction(action, this.props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 切换语言</span><br><span class="line">    setLanguage = () =&gt; &#123;</span><br><span class="line">        i18n.changeLanguage(&apos;zh&apos;); // or en</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        const &#123;t, store&#125; = this.props;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&apos;app-home&apos;&gt;</span><br><span class="line">                &lt;div className=&apos;app-header&apos;&gt;</span><br><span class="line">                    &lt;span&gt;&#123;t(&apos;title&apos;)&#125;&lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    content</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;Footer/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Test;</span><br></pre></td></tr></table></figure><h2 id="路由-acion，不需要-路由-recuder"><a href="#路由-acion，不需要-路由-recuder" class="headerlink" title="路由 acion，不需要 路由 recuder"></a>路由 acion，不需要 路由 recuder</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123;push&#125; from &apos;react-router-redux&apos;;</span><br><span class="line"></span><br><span class="line">let routerActions = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">routerActions[&apos;GOTO&apos;] = function (action, dispatch, state) &#123;</span><br><span class="line">    dispatch(push(action[&apos;content&apos;]));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default routerActions;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>一些容易被忽略的 javascript 知识点</title>
      <link href="/2017/05/10/%E4%B8%80%E4%BA%9B%E5%AE%B9%E6%98%93%E8%A2%AB%E5%BF%BD%E7%95%A5%E7%9A%84-javascript-%E7%9F%A5%E8%AF%86%E7%82%B9/"/>
      <url>/2017/05/10/%E4%B8%80%E4%BA%9B%E5%AE%B9%E6%98%93%E8%A2%AB%E5%BF%BD%E7%95%A5%E7%9A%84-javascript-%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<h2 id="ReferenceError和TypeError"><a href="#ReferenceError和TypeError" class="headerlink" title="ReferenceError和TypeError"></a>ReferenceError和TypeError</h2><p>如果 RHS 查询在所有嵌套的作用域中遍寻不到所需的变量，引擎就会抛出 ReferenceError<br>异常。如果 RHS 查询找到了一个变量，但是你尝试对这个变量的值进行不合理的操作，<br>比如试图对一个非函数类型的值进行函数调用，或着引用 null 或 undefined 类型的值中的<br>属性，那么引擎会抛出另外一种类型的异常，叫作 TypeError 。ReferenceError 同作用域判别失败相关，而 TypeError 则代表作用域判别成功了，但是对结果的操作是非法或不合理的。</p><h2 id="立即执行函数表达式"><a href="#立即执行函数表达式" class="headerlink" title="立即执行函数表达式"></a>立即执行函数表达式</h2><p>由于函数被包含在一对 ( ) 括号内部，因此成为了一个表达式，通过在末尾加上另外一个()可以立即执行这个函数，比如 (function foo(){ .. })() 。第一个()将函数变成表达式，第二个()执行了这个函数。</p><h2 id="let"><a href="#let" class="headerlink" title="let"></a>let</h2><p>let 关键字可以将变量绑定到所在的任意作用域中（通常是 { .. } 内部）。换句话说， let为其声明的变量隐式地了所在的块作用域。使用 let 进行的声明不会在块作用域中进行提升。声明的代码被运行之前，声明并不“存在” 。for 循环头部的let不仅将i绑定到了for循环的块中，事实上它将其重新绑定到了循环的每一个迭代中，确保使用上一个循环迭代结束时的值重新进行赋值。</p><h2 id="提升"><a href="#提升" class="headerlink" title="提升"></a>提升</h2><p>考虑以下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"><span class="built_in">console</span>.log( a );<span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p>考虑另外一段代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log( a );<span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>过程： 当你看到 var a = 2; 时，JavaScript 实际上会将其看成两个声明： var a; 和 a = 2; 。第一个定义声明是在编译阶段进行的。第二个赋值声明会被留在原地等待执行阶段。<br>第一个代码片段会以如下形式进行处理：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line">a = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log( a );</span><br></pre></td></tr></table></figure><p>其中第一部分是编译，而第二部分是执行。<br>第二个代码片段实际是按照以下流程处理的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"><span class="built_in">console</span>.log( a );</span><br><span class="line">a = <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>这个过程就叫作提升。但是函数表达式却不会被提升。例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">foo(); <span class="comment">// 不是 ReferenceError, 而是 TypeError!</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这段程序中的变量标识符 foo() 被提升并分配给所在作用域（在这里是全局作用域） ，因此foo()不会导致 ReferenceError 。但是 foo 此时并没有赋值（如果它是一个函数声明而不是函数表达式，那么就会赋值） 。 foo() 由于对 undefined 值进行函数调用而导致非法操作，因此抛出 TypeError 异常。<br>同时也要记住，即使是具名的函数表达式，名称标识符在赋值之前也无法在所在作用域中使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">foo(); <span class="comment">// TypeError</span></span><br><span class="line">bar(); <span class="comment">// ReferenceError</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这个代码片段经过提升后，实际上会被理解为以下形式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo;</span><br><span class="line">foo(); <span class="comment">// TypeError</span></span><br><span class="line">bar(); <span class="comment">// ReferenceError</span></span><br><span class="line">foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> bar = ...self...</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>函数声明和变量声明都会被提升。但是是函数会首先被提升，然后才是变量。<br>考虑以下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">foo(); <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">var</span> foo;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="number">1</span> );</span><br><span class="line">&#125;</span><br><span class="line">foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="number">2</span> );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>会输出 1 而不是 2 ！这个代码片段会被引擎理解为如下形式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="number">1</span> );</span><br><span class="line">&#125;</span><br><span class="line">foo(); <span class="comment">// 1</span></span><br><span class="line">foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="number">2</span> );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>注意， var foo 尽管出现在 function foo()… 的声明之前，但它是重复的声明（因此被忽<br>略了） ，因为函数声明会被提升到普通变量之前。尽管重复的 var 声明会被忽略掉，但出现在后面的函数声明还是可以覆盖前面的。</p><h2 id="作用域闭包"><a href="#作用域闭包" class="headerlink" title="作用域闭包"></a>作用域闭包</h2><p>定义：当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使函数是在当前词法作用<br>域之外执行。<br>下面这段代码清晰地展示了闭包：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log( a );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bar;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> baz = foo();</span><br><span class="line">baz(); <span class="comment">// 2 —— 这就是闭包的效果。</span></span><br></pre></td></tr></table></figure><p>bar() 显然可以被正常执行，但是它在自己定义的词法作用域以外的地方执行。看上去 foo() 的内容不会再被使用，所以很自然地会考虑对其进行回收。而闭包的“神奇”之处正是可以阻止这件事情的发生。事实上内部作用域依然存在，因此没有被回收。谁在使用这个内部作用域？原来是 bar() 本身在使用。拜 bar() 所声明的位置所赐，它拥有涵盖 foo() 内部作用域的闭包，使得该作用域能够一直存活，以供 bar() 在之后任何时间进行引用。bar() 依然持有对该作用域的引用，而这个引用就叫作闭包。</p><h2 id="typeof-null-“object”"><a href="#typeof-null-“object”" class="headerlink" title="typeof null = “object”"></a>typeof null = “object”</h2><p>不同的对象在底层都表示为二进制，在 JavaScript 中二进制前三位都为 0 的话会被判断为  object 类型， null 的二进制表示是全 0， 自然前三位也是 0， 所以执行 typeof 时会返回“ object ” 。</p><h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><p>使用 delete 运算符可以将单元从数组中删除，单元删除后，数组的 length 属性并不会发生变化</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [ ];</span><br><span class="line">a[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//  此处没有设置 a[1] 单元</span></span><br><span class="line">a[<span class="number">2</span>] = <span class="number">3</span>;</span><br><span class="line">a[<span class="number">1</span>]; <span class="comment">// undefined</span></span><br><span class="line">a.length; <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><p>上面的代码可以正常运行，但其中的 “ 空白单元 ” （ empty slot ）可能会导致出人意料的结果。另外：如果字符串键值能够被强制类型转换为十进制数字的话，它就会被当作数字索引来处理</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [ ];</span><br><span class="line">a[<span class="string">"13"</span>] = <span class="number">42</span>;</span><br><span class="line">a.length; <span class="comment">// 14</span></span><br></pre></td></tr></table></figure><h2 id="Number"><a href="#Number" class="headerlink" title="Number()"></a>Number()</h2><p>对于 . 运算符需要给予特别注意，因为它是一个有效的数字字符，会被优先识别为数字常量的一部分，然后才是对象属性访问运算符。<br>true 转换为 1 ， false 转换为 0 。 undefined 转换为 NaN ， null 转换为 0。<br>为了将值转换为相应的基本类型值，抽象操作 ToPrimitive 会首先（通过内部操作 DefaultValue）检查该值是否有 valueOf() 方法。如果有并且返回基本类型值，就使用该值进行强制类型转换。如果没有就使用 toString() 的返回值（如果存在）来进行强制类型转换。如果 valueOf() 和 toString() 均不返回基本类型值，会产生 TypeError 错误。<br>使用 Object.create(null) 创建的对象 [[Prototype]] 属性为 null ，并且没有 valueOf() 和 toString() 方法，因此无法进行强制类型转换。看下面的例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  无效语法：因为 . 被视为常量 42. 的一部分，所以没有. 属性访问运算符来调用 tofixed 方法</span></span><br><span class="line"><span class="number">42.</span>toFixed( <span class="number">3</span> );    <span class="comment">// SyntaxError</span></span><br><span class="line"><span class="comment">//  下面的语法都有效：</span></span><br><span class="line">(<span class="number">42</span>).toFixed( <span class="number">3</span> );  <span class="comment">// "42.000"</span></span><br><span class="line"><span class="number">0.42</span>.toFixed( <span class="number">3</span> );  <span class="comment">// "0.420"</span></span><br><span class="line"><span class="number">42.</span>.toFixed( <span class="number">3</span> );   <span class="comment">// "42.000"</span></span><br><span class="line"><span class="number">42</span> .toFixed(<span class="number">3</span>);     <span class="comment">// "42.000"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">valueOf: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"42"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> b = &#123;</span><br><span class="line">    toString: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"42"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> c = [<span class="number">4</span>,<span class="number">2</span>];</span><br><span class="line">c.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.join( <span class="string">""</span> ); <span class="comment">// "42"</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Number</span>( a ); <span class="comment">// 42</span></span><br><span class="line"><span class="built_in">Number</span>( b ); <span class="comment">// 42</span></span><br><span class="line"><span class="built_in">Number</span>( c ); <span class="comment">// 42</span></span><br><span class="line"><span class="built_in">Number</span>( <span class="string">""</span> ); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Number</span>( [] ); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Number</span>( [ <span class="string">"abc"</span> ] ); <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure><h2 id="Boolean"><a href="#Boolean" class="headerlink" title="Boolean"></a>Boolean</h2><ol><li>假值 undefined,null,false,+0,-0,NaN,””。<strong>假值列表以外的值都是真值</strong></li><li>假值对象<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Boolean</span>( <span class="literal">false</span> );</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="built_in">Number</span>( <span class="number">0</span> );</span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> <span class="built_in">String</span>( <span class="string">""</span> );</span><br><span class="line"><span class="keyword">var</span> d = <span class="built_in">Boolean</span>( a &amp;&amp; b &amp;&amp; c );</span><br><span class="line">d; <span class="comment">// true 说明 a 、 b 、 c 都为 true</span></span><br></pre></td></tr></table></figure></li></ol><p>虽然 JavaScript  代码中会出现假值对象，但它实际上并不属于 JavaScript  语言的范畴。<br>浏览器在某些特定情况下，在常规 JavaScript 语法基础上自己创建了一些外来值，这些就是 “ 假值对象 ” 。假值对象看起来和普通对象并无二致（都有属性，等等），但将它们强制类型转换为布尔值时结果为 false 。最常见的例子是 document.all ，它是一个类数组对象，包含了页面上的所有元素，由 DOM （而不是 JavaScript  引擎）提供给 JavaScript  程序使用。它以前曾是一个真正意义上的对象，布尔强制类型转换结果为 true ，不过现在它是一个假值对象。document.all 并不是一个标准用法，早就被废止了。</p><h2 id="奇特的-运算符"><a href="#奇特的-运算符" class="headerlink" title="奇特的 ~ 运算符"></a>奇特的 ~ 运算符</h2><ol><li><p>类型转换<br>它首先将值强制类型转换为 32  位数字，然后执行字位操作 “ 非 ” （对每一个字位进行反转）。这与 ! 很相像，不仅将值强制类型转换为布尔值 &lt; ，还对其做字位反转。对 ~ 还可以有另外一种诠释，源自早期的计算机科学和离散数学： ~ 返回 2  的补码。~x 大致等同于 -(x+1) 。<br>~ 和 indexOf() 一起可以将结果强制类型转换（实际上仅仅是转换）为真 /  假值：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">"Hello World"</span>;</span><br><span class="line">~a.indexOf( <span class="string">"lo"</span> ); <span class="comment">// -4 &lt;--  真值 !</span></span><br><span class="line"><span class="keyword">if</span> (~a.indexOf( <span class="string">"lo"</span> )) &#123; <span class="comment">// true</span></span><br><span class="line"><span class="comment">//  找到匹配！</span></span><br><span class="line">&#125;</span><br><span class="line">~a.indexOf( <span class="string">"ol"</span> ); <span class="comment">// 0 &lt;--  假值 !</span></span><br><span class="line">!~a.indexOf( <span class="string">"ol"</span> ); <span class="comment">// true</span></span><br><span class="line"><span class="keyword">if</span> (!~a.indexOf( <span class="string">"ol"</span> )) &#123; <span class="comment">// true</span></span><br><span class="line"><span class="comment">//  没有找到匹配！</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果 indexOf(..) 返回 -1 ， ~ 将其转换为假值 0 ，其他情况一律转换为真值。</p></li><li><p>字位截除<br>使用 <del>~ 来截除数字值的小数部分，以为这和 Math.floor(..) 的效果一样，实际上并非如此。</del> 中的第一个 ~ 执行 ToInt32 并反转字位，然后第二个 ~ 再进行一次字位反转，即将所有字位反转回原值，最后得到的仍然是 ToInt32 的结果。~~ 和 !! 很相似，它只适用于 32 位数字，更重要的是它对负数的处理与 Math.floor(..) 不同。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.floor( <span class="number">-49.6</span> ); <span class="comment">// -50</span></span><br><span class="line">~~<span class="number">-49.6</span>; <span class="comment">// -49</span></span><br></pre></td></tr></table></figure><p><del>x 能将值截除为一个 32  位整数， x | 0 也可以，而且看起来还更简洁。出于对运算符优先级的考虑，我们可能更倾向于使用 ~</del>x 。</p><h2 id="和"><a href="#和" class="headerlink" title="== 和 ==="></a>== 和 ===</h2><p>常见的误区是：“ == 检查值是否相等， === 检查值和类型是否相等 ” 。听起来蛮有道理，然而还不够准确。<br>正确的解释是：“ == 允许在相等比较中进行强制类型转换，而 === 不允许。”<br>两种解释的区别：<br>根据第一种解释（不准确的版本）， === 似乎比 == 做的事情更多，因为它还要检查值的类型。第二种解释中 == 的工作量更大一些，因为如果值的类型不同还需要进行强制类型转换。有人觉得 == 会比 === 慢，实际上虽然强制类型转换确实要多花点时间，但仅仅是微秒级（百万分之一秒）的差别而已。如果进行比较的两个值类型相同，则 == 和 === 使用相同的算法，所以除了 JavaScript  引擎实现上的细微差别之外，它们之间并没有什么不同。<br>== 和 === 都会检查操作数的类型。区别在于<strong>操作数类型不同时它们的处理方式不同</strong>。</p></li></ol><h2 id="抽象关系比较-a-lt-b"><a href="#抽象关系比较-a-lt-b" class="headerlink" title="抽象关系比较 a &lt; b"></a>抽象关系比较 a &lt; b</h2><p>分为两个部分：比较双方都是字符串（后半部分）和其他情况（前半部分）。比较双方首先调用 ToPrimitive ，如果结果出现非字符串，就根据 ToNumber 规则将双方强制类型转换为数字来进行比较。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [ <span class="number">42</span> ];</span><br><span class="line"><span class="keyword">var</span> b = [ <span class="string">"43"</span> ];</span><br><span class="line">a &lt; b; <span class="comment">// true</span></span><br><span class="line">b &lt; a; <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p> -0 和 NaN 的相关规则在这里也适用。如果比较双方都是字符串，则按字母顺序来进行比较</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [ <span class="string">"42"</span> ];</span><br><span class="line"><span class="keyword">var</span> b = [ <span class="string">"043"</span> ];</span><br><span class="line">a &lt; b; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = [ <span class="number">4</span>, <span class="number">2</span> ];</span><br><span class="line"><span class="keyword">var</span> b = [ <span class="number">0</span>, <span class="number">4</span>, <span class="number">3</span> ];</span><br><span class="line">a &lt; b; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">b</span>: <span class="number">42</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> b = &#123; <span class="attr">b</span>: <span class="number">43</span> &#125;;</span><br><span class="line">a &lt; b; <span class="comment">// ??</span></span><br><span class="line"><span class="comment">// 结果还是 false ，因为 a 是 [object Object] ，b 也是 [object Object]，所以按照字母顺序 a &lt; b 并不成立。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 下面的例子就有些奇怪了:</span></span><br><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">b</span>: <span class="number">42</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> b = &#123; <span class="attr">b</span>: <span class="number">43</span> &#125;;</span><br><span class="line">a &lt; b; <span class="comment">// false</span></span><br><span class="line">a == b; <span class="comment">// false</span></span><br><span class="line">a &gt; b; <span class="comment">// false</span></span><br><span class="line">a &lt;= b; <span class="comment">// true</span></span><br><span class="line">a &gt;= b; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>因为根据规范 a &lt;= b 被处理为 b &lt; a ，然后将结果反转。因为 b &lt; a 的结果是 false ，所以 a &lt;= b 的结果是 true。实际上 JavaScript  中 &lt;= 是 “ 不大于 ” 的意思（即 !(a &gt; b) ，处理为 !(b &lt; a) ）。同理 a &gt;= b 处理为 b &lt;= a 。</p><h2 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString"></a>toString</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[] + &#123;&#125;; <span class="comment">// "[object Object]"</span></span><br><span class="line">&#123;&#125; + []; <span class="comment">// 0</span></span><br><span class="line">[<span class="literal">null</span>].toString() <span class="comment">// ""</span></span><br><span class="line">[<span class="literal">undefined</span>].toString() <span class="comment">// ""</span></span><br><span class="line">[<span class="literal">null</span>, <span class="literal">undefined</span>].toString() <span class="comment">// ","</span></span><br></pre></td></tr></table></figure><p>第一行代码中， {} 出现在 + 运算符表达式中，因此它被当作一个值（空对象）来处理。 [] 会被强制类型转换为 “” ，而 {} 会被强制类型转换为 “[object Object]” 。<br>但在第二行代码中， {} 被当作一个独立的空代码块（不执行任何操作）。代码块结尾不需要分号，所以这里不存在语法上的问题。最后 + [] 将 [] 显式强制类型转换为 0 。</p><h2 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123; <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 实例化一个Person</span></span><br><span class="line"><span class="keyword">var</span> alice = <span class="keyword">new</span> Person(<span class="string">'alice'</span>);</span><br><span class="line"><span class="comment">// 不要这么做!</span></span><br><span class="line">Person(<span class="string">'bob'</span>); <span class="comment">//=&gt; undefined</span></span><br></pre></td></tr></table></figure><p>这个函数只会返回 undefined，并且执行上下文是 window(全局)对象，你无意间创建了一个全局变量 name。调用构造函数时不要丢掉 new 关键字。当使用 new 关键字来调用构造函数时，执行上下文从全局对象(window)变成一个空的 上下文，这个上下文代表了新生成的实例。因此，this 关键字指向当前创建的实例。默认情况下，如果你的构造函数中没有返回任何内容，就会返回 this——当前的上下文。 要不然就返回任意非原始类型的值。</p><h2 id="bind-实现"><a href="#bind-实现" class="headerlink" title="bind 实现"></a>bind 实现</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="built_in">Function</span>.prototype.bind || <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> slice = [].slice,</span><br><span class="line">args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>), self = <span class="keyword">this</span>,</span><br><span class="line">nop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">bound = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> self.apply( <span class="keyword">this</span> <span class="keyword">instanceof</span> nop ? <span class="keyword">this</span> : (obj || &#123;&#125;), args.concat(slice.call(<span class="built_in">arguments</span>)));</span><br><span class="line">&#125;;</span><br><span class="line">nop.prototype = self.prototype; bound.prototype = <span class="keyword">new</span> nop();</span><br><span class="line"><span class="keyword">return</span> bound; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="Object-create-实现"><a href="#Object-create-实现" class="headerlink" title="Object.create() 实现"></a>Object.create() 实现</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.create = <span class="built_in">Object</span>.create || <span class="function"><span class="keyword">function</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">F.prototype = o;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
